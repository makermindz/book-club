<script>document.write(decodeURIComponent(escape(atob("PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+U1RFTSBOYXR1cmUgQWR2ZW50dXJlczwvdGl0bGU+CiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4udGFpbHdpbmRjc3MuY29tIj48L3NjcmlwdD4KICAgIDxzY3JpcHQ+CiAgICAgICAgdGFpbHdpbmQuY29uZmlnID0gewogICAgICAgICAgICB0aGVtZTogewogICAgICAgICAgICAgICAgZXh0ZW5kOiB7CiAgICAgICAgICAgICAgICAgICAgY29sb3JzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICdzdG9yeS1ibHVlJzogJyMzYjgyZjYnLAogICAgICAgICAgICAgICAgICAgICAgICAnc3RvcnktZ3JlZW4nOiAnIzIyYzU1ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICdzdG9yeS1kYXJrJzogJyMxZTFiNGInLAogICAgICAgICAgICAgICAgICAgICAgICAncGFwZXInOiAnI2ZlZmNlOCcsIC8vIEEgd2FybWVyLCBtb3JlIHBhcGVyeSB5ZWxsb3cKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZvbnRGYW1pbHk6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2FuczogWydTZWdvZSBVSScsICdUYWhvbWEnLCAnR2VuZXZhJywgJ1ZlcmRhbmEnLCAnc2Fucy1zZXJpZiddLAogICAgICAgICAgICAgICAgICAgICAgICBzZXJpZjogWydHZW9yZ2lhJywgJ0NhbWJyaWEnLCAnVGltZXMgTmV3IFJvbWFuJywgJ1RpbWVzJywgJ3NlcmlmJ10sCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBib3hTaGFkb3c6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ2Jvb2snOiAnMCAyNXB4IDUwcHggLTEycHggcmdiYSgwLCAwLCAwLCAwLjUpLCAwIDAgMTVweCByZ2JhKDAsMCwwLDAuMSknLAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIC8vIERpc2FibGUgcmlnaHQtY2xpY2sKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIGV2ZW50ID0+IGV2ZW50LnByZXZlbnREZWZhdWx0KCkpOwoKICAvLyBEaXNhYmxlIEYxMiwgQ3RybCtTaGlmdCtJLCBDdHJsK1UKICBkb2N1bWVudC5vbmtleWRvd24gPSBmdW5jdGlvbihlKSB7CiAgICBpZihldmVudC5rZXlDb2RlID09IDEyMykgcmV0dXJuIGZhbHNlOwogICAgaWYoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgZS5rZXlDb2RlID09ICdJJy5jaGFyQ29kZUF0KDApKSByZXR1cm4gZmFsc2U7CiAgICBpZihlLmN0cmxLZXkgJiYgZS5rZXlDb2RlID09ICdVJy5jaGFyQ29kZUF0KDApKSByZXR1cm4gZmFsc2U7CiAgfTsKICAKICAgIDwvc2NyaXB0PgogICAgPHN0eWxlPgogICAgICAgIDpyb290IHsKICAgICAgICAgICAgLS1wYXBlcjogIzA0MjM0YTsKICAgICAgICB9CiAgICAgICAgYm9keSB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmZmZmY7CiAgICAgICAgICAgIGhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIH0KCiAgICAgICAgLnBhZ2UtY29udGFpbmVyIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgd2lkdGg6IDkwdnc7CiAgICAgICAgICAgIG1heC13aWR0aDogMTEwMHB4OwogICAgICAgICAgICBoZWlnaHQ6IDgwdmg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHZhcigtLXBhcGVyKTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAyMHB4IDQwcHggcmdiYSgwLDAsMCwwLjQpOwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAubGVmdC1wYWdlIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgcGFkZGluZzogM3JlbTsKICAgICAgICAgICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgI2U1ZTdlYjsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byByaWdodCwgdmFyKC0tcGFwZXIpIDk5JSwgI2YzZjRmNiAxMDAlKTsKICAgICAgICB9CgogICAgICAgIC5yaWdodC1wYWdlIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNkMWQ1ZGI7CiAgICAgICAgfQoKICAgICAgICBjYW52YXMgewogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICB9CgogICAgICAgIC5uYXYtYnRuIHsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsKICAgICAgICB9CiAgICAgICAgLm5hdi1idG46aG92ZXI6bm90KDpkaXNhYmxlZCkgewogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTJweCk7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjEpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAuc3RvcnktdGV4dCB7CiAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAxLjg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4xcmVtOwogICAgICAgICAgICBjb2xvcjogI2ZmZmZmZjsKICAgICAgICB9CiAgICAgICAgLmNoYXB0ZXItdGl0bGUgewogICAgICAgICAgICBmb250LWZhbWlseTogJ0dlb3JnaWEnLCBzZXJpZjsKICAgICAgICAgICAgY29sb3I6ICNmZmZmZmY7CiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDNweCBzb2xpZCAjZmZmMDAwOwogICAgICAgICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAwLjVyZW07CiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEuNXJlbTsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgoKICAgIDxkaXYgY2xhc3M9InBhZ2UtY29udGFpbmVyIj4KICAgICAgICAKICAgICAgICA8ZGl2IGNsYXNzPSJsZWZ0LXBhZ2UiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJtYi1hdXRvIj4KICAgICAgICAgICAgICAgIDxoMSBpZD0ic3RvcnktdGl0bGUiIGNsYXNzPSJ0ZXh0LTR4bCBmb250LWJvbGQgbWItNiBjaGFwdGVyLXRpdGxlIj5UaGUgQ29zbWljIFdhbHR6PC9oMT4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InN0b3J5LWNvbnRlbnQiIGNsYXNzPSJzdG9yeS10ZXh0Ij4KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZ2FwLTQgbXQtOCBwdC02IGJvcmRlci10IGJvcmRlci1ncmF5LTIwMCI+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJidG4tcHJldiIgb25jbGljaz0iQm9vay5wcmV2KCkiIGNsYXNzPSJuYXYtYnRuIHB4LTYgcHktMiByb3VuZGVkLWZ1bGwgYm9yZGVyLTIgYm9yZGVyLWdyYXktMzAwIHRleHQtd2hpdGUgZm9udC1ib2xkIGhvdmVyOmJvcmRlci1zdG9yeS1ibHVlIGhvdmVyOnRleHQtc3RvcnktYmx1ZSBkaXNhYmxlZDpvcGFjaXR5LTMwIGRpc2FibGVkOmN1cnNvci1ub3QtYWxsb3dlZCI+CiAgICAgICAgICAgICAgICAgICAgUHJldmlvdXMKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0iYnRuLW5leHQiIG9uY2xpY2s9IkJvb2submV4dCgpIiBjbGFzcz0ibmF2LWJ0biBmbGV4LTEgcHgtNiBweS0yIHJvdW5kZWQtZnVsbCBiZy1zdG9yeS1ncmVlbiB0ZXh0LXdoaXRlIGZvbnQtYm9sZCBob3ZlcjpiZy1ncmVlbi03MDAgc2hhZG93LW1kIj4KICAgICAgICAgICAgICAgICAgICBOZXh0IEFkdmVudHVyZSDihpIKICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgCiAgICAgICAgPGRpdiBjbGFzcz0icmlnaHQtcGFnZSI+CiAgICAgICAgICAgIDxjYW52YXMgaWQ9InNpbS1jYW52YXMiPjwvY2FudmFzPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJhYnNvbHV0ZSBib3R0b20tNCByaWdodC00IHRleHQtd2hpdGUgdGV4dC1zIHNlbGVjdC1ub25lIj4mY29weTsgTWFrZXIgTWluZHo8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxzY3JpcHQ+CiAgICAgICAgY29uc3QgU3RvcmllcyA9IFsKICAgICAgICAgICAgLy8gLS0tIEFTVFJPTk9NWSAmIEVBUlRIIC0tLQogICAgICAgICAgICB7IHRpdGxlOiAiVGhlIENvc21pYyBXYWx0eiIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+TG9uZyBhZ28sIGEgc3RhciB3YXMgYm9ybi4gSXQgc3B1biBhbmQgcHVsbGVkIGR1c3QgYW5kIHJvY2tzIGludG8gYSBncmFuZCB3YWx0ei4gVGhlc2Ugcm9ja3MgYmVjYW1lIHBsYW5ldHMsIGVhY2ggd2l0aCBpdHMgb3duIHBlcnNvbmFsaXR5LjwvcD48cD5XYXRjaCBhcyB0aGV5IHRyYWNlIHRoZWlyIHBhdGhzIHRocm91Z2ggdGhlIHZvaWQsIGEgY2xvY2t3b3JrIG1lY2hhbmlzbSBoZWxkIGJ5IHRoZSBpbnZpc2libGUgc3RyaW5nIG9mIDxzdHJvbmc+R3Jhdml0eTwvc3Ryb25nPi48L3A+YCwgc2ltOiAic29sYXJTeXN0ZW0iIH0sCiAgICAgICAgICAgIHsgdGl0bGU6ICJUaGUgU2hha2luZyBHcm91bmQiLCB0ZXh0OiBgPHAgY2xhc3M9Im1iLTQiPlRoZSBFYXJ0aCdzIHN1cmZhY2UgaXMgYSBwdXp6bGUgb2YgZ2lhbnQgcGllY2VzIGNhbGxlZCA8c3Ryb25nPlRlY3RvbmljIFBsYXRlczwvc3Ryb25nPi4gVGhleSBzbG93bHkgZHJpZnQsIGJ1dCBzb21ldGltZXMgdGhleSBnZXQgc3R1Y2suIFdoZW4gdGhlIHByZXNzdXJlIGJ1aWxkcyBhbmQgdGhleSBzdWRkZW5seSBzbGlwLCB0aGUgZ3JvdW5kIHNoYWtlcyB2aW9sZW50bHkuPC9wPjxwPlRoaXMgaXMgYW4gPHN0cm9uZz5FYXJ0aHF1YWtlPC9zdHJvbmc+LCByZWxlYXNpbmcgZW5lcmd5IGFzIHNlaXNtaWMgd2F2ZXMgdGhhdCB0cmF2ZWwgdGhyb3VnaCB0aGUgcGxhbmV0LjwvcD5gLCBzaW06ICJlYXJ0aHF1YWtlIiB9LAogICAgICAgICAgICB7IHRpdGxlOiAiVGhlIEZpZXJ5IE1vdW50YWluIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5EZWVwIGJlbmVhdGggdGhlIEVhcnRoLCByb2NrIG1lbHRzIGludG8gYSBmaWVyeSBzb3VwIGNhbGxlZCA8c3Ryb25nPk1hZ21hPC9zdHJvbmc+LiBMaWdodGVyIHRoYW4gdGhlIHNvbGlkIHJvY2sgYXJvdW5kIGl0LCBpdCByaXNlcywgZmluZGluZyBjcmFja3MgYW5kIHdlYWtuZXNzZXMgaW4gdGhlIGNydXN0LjwvcD48cD5XaGVuIGl0IGJ1cnN0cyB0aHJvdWdoIHRoZSBzdXJmYWNlLCBhIDxzdHJvbmc+Vm9sY2Fubzwvc3Ryb25nPiBlcnVwdHMsIHNwZXdpbmcgYXNoLCBnYXMsIGFuZCBtb2x0ZW4gbGF2YS48L3A+YCwgc2ltOiAidm9sY2FubyIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBTa3kncyBHcmVhdCBSaXZlciIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+VGhlIHN1bidzIHdhcm10aCB0dXJucyB3YXRlciBmcm9tIG9jZWFucyBhbmQgbGFrZXMgaW50byBhbiBpbnZpc2libGUgZ2FzIGNhbGxlZCB3YXRlciB2YXBvci4gVGhpcyBpcyA8c3Ryb25nPkV2YXBvcmF0aW9uPC9zdHJvbmc+LiBBcyBpdCByaXNlcywgaXQgY29vbHMgYW5kIGZvcm1zIGNsb3VkcyAoPHN0cm9uZz5Db25kZW5zYXRpb248L3N0cm9uZz4pLjwvcD48cD5XaGVuIHRoZSBjbG91ZHMgZ2V0IHRvbyBoZWF2eSwgdGhlIHdhdGVyIGZhbGxzIGJhY2sgdG8gRWFydGggYXMgcmFpbiwgc25vdywgb3IgaGFpbC4gVGhpcyBpcyB0aGUgPHN0cm9uZz5XYXRlciBDeWNsZTwvc3Ryb25nPiwgYW4gZW5kbGVzcyBqb3VybmV5LjwvcD5gLCBzaW06ICJ3YXRlckN5Y2xlIiB9LAogICAgICAgICAgICB7IHRpdGxlOiAiVGhlIEZsYXNoIG9mIHRoZSBTdG9ybSIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+SW5zaWRlIGEgc3Rvcm0gY2xvdWQsIHRpbnkgaWNlIGNyeXN0YWxzIGFuZCB3YXRlciBkcm9wbGV0cyBydWIgdG9nZXRoZXIsIGJ1aWxkaW5nIHVwIHN0YXRpYyBlbGVjdHJpY2l0eS4gVGhlIHRvcCBvZiB0aGUgY2xvdWQgYmVjb21lcyBwb3NpdGl2ZSwgYW5kIHRoZSBib3R0b20gYmVjb21lcyBuZWdhdGl2ZS48L3A+PHA+V2hlbiB0aGUgY2hhcmdlIGlzIHN0cm9uZyBlbm91Z2gsIGl0IGxlYXBzIHRvIHRoZSBncm91bmQgaW4gYSBnaWFudCwgc3VwZXItaG90IHNwYXJrIHdlIGNhbGwgPHN0cm9uZz5MaWdodG5pbmc8L3N0cm9uZz4uPC9wPmAsIHNpbTogImxpZ2h0bmluZyIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBQYWludGVkIFNreSIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+VGhlIFN1biBjb25zdGFudGx5IHNlbmRzIG91dCBhIHN0cmVhbSBvZiBjaGFyZ2VkIHBhcnRpY2xlcyBjYWxsZWQgdGhlIHNvbGFyIHdpbmQuIEVhcnRoJ3MgbWFnbmV0aWMgZmllbGQgcHJvdGVjdHMgdXMsIGZ1bm5lbGluZyB0aGVzZSBwYXJ0aWNsZXMgdG93YXJkcyB0aGUgcG9sZXMuPC9wPjxwPldoZW4gdGhleSBoaXQgZ2FzZXMgaW4gb3VyIGF0bW9zcGhlcmUsIHRoZXkgZ2xvdywgY3JlYXRpbmcgYmVhdXRpZnVsLCBkYW5jaW5nIGN1cnRhaW5zIG9mIGxpZ2h0IGtub3duIGFzIHRoZSA8c3Ryb25nPkF1cm9yYTwvc3Ryb25nPi48L3A+YCwgc2ltOiAiYXVyb3JhIiB9LAogICAgICAgICAgICB7IHRpdGxlOiAiVGhlIE9jZWFuJ3MgQnJlYXRoIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5Ud2ljZSBhIGRheSwgdGhlIG9jZWFuIGxldmVscyByaXNlIGFuZCBmYWxsLiBUaGlzIGlzIHRoZSByaHl0aG0gb2YgdGhlIDxzdHJvbmc+VGlkZXM8L3N0cm9uZz4uIEl0J3MgY2F1c2VkIGJ5IHRoZSBncmF2aXRhdGlvbmFsIHB1bGwgb2YgdGhlIE1vb24sIGFuZCB0byBhIGxlc3NlciBleHRlbnQsIHRoZSBTdW4uPC9wPjxwPlRoZSBNb29uJ3MgZ3Jhdml0eSBwdWxscyB0aGUgd2F0ZXIgb24gdGhlIG5lYXIgc2lkZSwgY3JlYXRpbmcgYSBidWxnZS4gQSBzZWNvbmQgYnVsZ2UgZm9ybXMgb24gdGhlIGZhciBzaWRlIGFzIHRoZSBFYXJ0aCBpcyBwdWxsZWQgYXdheSBmcm9tIHRoZSB3YXRlci48L3A+YCwgc2ltOiAidGlkZXMiIH0sCiAgICAgICAgICAgIHsgdGl0bGU6ICJUaGUgU3RhciBFYXRlciIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+V2hlbiBhIHRydWx5IG1hc3NpdmUgc3RhciBkaWVzLCBpdCBjYW4gY29sbGFwc2UgdW5kZXIgaXRzIG93biBncmF2aXR5LCBzcXVlZXppbmcgYWxsIGl0cyBtYXR0ZXIgaW50byBhbiBpbmZpbml0ZWx5IHNtYWxsIHBvaW50LiBUaGlzIGNyZWF0ZXMgYSA8c3Ryb25nPkJsYWNrIEhvbGU8L3N0cm9uZz4uPC9wPjxwPkl0cyBncmF2aXR5IGlzIHNvIHBvd2VyZnVsIHRoYXQgbm90aGluZywgbm90IGV2ZW4gbGlnaHQsIGNhbiBlc2NhcGUgb25jZSBpdCBjcm9zc2VzIHRoZSBldmVudCBob3Jpem9uLiBJdCdzIHRoZSB1bHRpbWF0ZSBjb3NtaWMgdmFjdXVtIGNsZWFuZXIuPC9wPmAsIHNpbTogImJsYWNrSG9sZSIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBGYWxsaW5nIFN0YXJzIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5BcyBjb21ldHMgdHJhdmVsIG5lYXIgdGhlIFN1biwgdGhleSBsZWF2ZSBhIHRyYWlsIG9mIGR1c3QgYW5kIGljZS4gV2hlbiBFYXJ0aCBwYXNzZXMgdGhyb3VnaCB0aGlzIHRyYWlsLCB0aGUgdGlueSBkZWJyaXMgcGFydGljbGVzIGJ1cm4gdXAgaW4gb3VyIGF0bW9zcGhlcmUuPC9wPjxwPldlIHNlZSB0aGVzZSBidXJuaW5nIHBhcnRpY2xlcyBhcyBicmlnaHQgc3RyZWFrcyBvZiBsaWdodCBhY3Jvc3MgdGhlIG5pZ2h0IHNreSwga25vd24gYXMgYSA8c3Ryb25nPk1ldGVvciBTaG93ZXI8L3N0cm9uZz4uPC9wPmAsIHNpbTogIm1ldGVvclNob3dlciIgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSBCSU9MT0dZICYgRUNPTE9HWSAtLS0KICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBMZWFmJ3MgS2l0Y2hlbiIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+RGVlcCBpbnNpZGUgZXZlcnkgZ3JlZW4gbGVhZiwgYSBtYWdpY2FsIGtpdGNoZW4gaXMgYWx3YXlzIG9wZW4uIFRoZSBjaGVmcyBhcmUgY2FsbGVkIDxzdHJvbmc+Q2hsb3JvcGxhc3RzPC9zdHJvbmc+LjwvcD48cD5UaGV5IHVzZSBzdW5saWdodCwgd2F0ZXIsIGFuZCBjYXJib24gZGlveGlkZSB0byBjb29rIHVwIHN3ZWV0IHN1Z2FyIGZvciB0aGUgcGxhbnQgdG8gZWF0LiBUaGlzIGFtYXppbmcgcHJvY2VzcyBpcyBjYWxsZWQgPHN0cm9uZz5QaG90b3N5bnRoZXNpczwvc3Ryb25nPi48L3A+YCwgc2ltOiAicGhvdG9zeW50aGVzaXMiIH0sCiAgICAgICAgICAgIHsgdGl0bGU6ICJUaGUgV2hpc3BlcmluZyBXb29kcyIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+QmVuZWF0aCB0aGUgZm9yZXN0IGZsb29yIGxpZXMgYSBzZWNyZXQgbmV0d29yay4gQSB2YXN0LCBoaWRkZW4gd2ViIG9mIGZ1bmdhbCB0aHJlYWRzIGNhbGxlZCBhIDxzdHJvbmc+TXljZWxpdW0gTmV0d29yazwvc3Ryb25nPiBjb25uZWN0cyB0aGUgcm9vdHMgb2YgdHJlZXMuPC9wPjxwPlRyZWVzIHVzZSB0aGlzICJXb29kIFdpZGUgV2ViIiB0byBzaGFyZSBudXRyaWVudHMgYW5kIHNlbmQgd2FybmluZyBzaWduYWxzIHRvIGVhY2ggb3RoZXIgYWJvdXQgcGVzdHMgb3IgZHJvdWdodC4gSXQncyBhIGZvcmVzdCdzIGludGVybmV0ITwvcD5gLCBzaW06ICJteWNlbGl1bSIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBCdXN5IEJlZSdzIEpvdXJuZXkiLCB0ZXh0OiBgPHAgY2xhc3M9Im1iLTQiPkZsb3dlcnMgbmVlZCB0byBzaGFyZSBwb2xsZW4gdG8gbWFrZSBzZWVkcy4gVGhleSBjYW4ndCB3YWxrLCBzbyB0aGV5IGhpcmUgbWVzc2VuZ2VycyEgQmVlcywgc2VhcmNoaW5nIGZvciBzd2VldCBuZWN0YXIsIGdldCBjb3ZlcmVkIGluIHllbGxvdyBwb2xsZW4gZHVzdC48L3A+PHA+QXMgYSBiZWUgZmxpZXMgdG8gdGhlIG5leHQgZmxvd2VyLCBpdCBjYXJyaWVzIHRoZSBwb2xsZW4gd2l0aCBpdCwgaGVscGluZyB0aGUgcGxhbnRzIHJlcHJvZHVjZS4gVGhpcyBpcyA8c3Ryb25nPlBvbGxpbmF0aW9uPC9zdHJvbmc+LjwvcD5gLCBzaW06ICJwb2xsaW5hdGlvbiIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBXaW5nZWQgV29uZGVyIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5BIGNhdGVycGlsbGFyJ3MgbGlmZSBpcyBhIHN0b3J5IG9mIGluY3JlZGlibGUgY2hhbmdlLiBJdCBoYXRjaGVzIGZyb20gYW4gZWdnLCBlYXRzIGxlYXZlcywgYW5kIGdyb3dzLiBUaGVuLCBpdCBmb3JtcyBhIHByb3RlY3RpdmUgc2hlbGwgY2FsbGVkIGEgY2hyeXNhbGlzLjwvcD48cD5JbnNpZGUsIGl0IGNvbXBsZXRlbHkgdHJhbnNmb3JtcyBpdHMgYm9keS4gV2hlbiBpdCBlbWVyZ2VzLCBpdCBpcyBhIGJlYXV0aWZ1bCBidXR0ZXJmbHkuIFRoaXMgbWFnaWNhbCBjaGFuZ2UgaXMgY2FsbGVkIDxzdHJvbmc+TWV0YW1vcnBob3Npczwvc3Ryb25nPi48L3A+YCwgc2ltOiAibWV0YW1vcnBob3NpcyIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBXYW5kZXJpbmcgU2VlZCIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+QSBwbGFudCBjYW4ndCB3YWxrIHRvIGZpbmQgYSBuZXcgaG9tZSBmb3IgaXRzIGJhYmllcyAoc2VlZHMpLiBTbywgaXQgZ2l2ZXMgdGhlbSB3aW5ncyEgU29tZSBzZWVkcywgbGlrZSBkYW5kZWxpb25zLCBoYXZlIGZsdWZmeSBwYXJhY2h1dGVzIHRvIHJpZGUgdGhlIHdpbmQuPC9wPjxwPk90aGVycyBoYXZlIGhvb2tzIHRvIGNhdGNoIGEgcmlkZSBvbiBhbmltYWwgZnVyLiBUaGlzIGNsZXZlciB0cmljayBpcyBjYWxsZWQgPHN0cm9uZz5TZWVkIERpc3BlcnNhbDwvc3Ryb25nPi48L3A+YCwgc2ltOiAic2VlZERpc3BlcnNhbCIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBMaXZpbmcgSmV3ZWxzIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5BIDxzdHJvbmc+Q29yYWwgUmVlZjwvc3Ryb25nPiBpcyBsaWtlIGEgYnVzdGxpbmcgdW5kZXJ3YXRlciBjaXR5LCBidWlsdCBieSB0aW55IGFuaW1hbHMgY2FsbGVkIHBvbHlwcy4gVGhlc2UgcG9seXBzIGhhdmUgYSBzcGVjaWFsIGZyaWVuZHNoaXAgd2l0aCB0aW55IGFsZ2FlIGxpdmluZyBpbnNpZGUgdGhlbS48L3A+PHA+VGhlIGFsZ2FlIG1ha2UgZm9vZCBmb3IgdGhlIGNvcmFsIHVzaW5nIHN1bmxpZ2h0LCBhbmQgaW4gcmV0dXJuLCB0aGUgY29yYWwgZ2l2ZXMgdGhlbSBhIHNhZmUgaG9tZS4gVGhpcyB0ZWFtd29yaywgY2FsbGVkIHN5bWJpb3NpcywgY3JlYXRlcyB0aGUgcmVlZidzIHZpYnJhbnQgY29sb3JzLjwvcD5gLCBzaW06ICJjb3JhbFJlZWYiIH0sCiAgICAgICAgICAgIHsgdGl0bGU6ICJUaGUgVHdpbGlnaHQgTGFudGVybnMiLCB0ZXh0OiBgPHAgY2xhc3M9Im1iLTQiPk9uIGEgd2FybSBzdW1tZXIgZXZlbmluZywgeW91IG1pZ2h0IHNlZSB0aW55IGJsaW5raW5nIGxpZ2h0cyBpbiB0aGUgZ3Jhc3MuIFRoZXNlIGFyZSA8c3Ryb25nPkZpcmVmbGllczwvc3Ryb25nPiEgVGhleSBhcmVuJ3Qgb24gZmlyZTsgdGhleSBhcmUgbWFraW5nIHRoZWlyIG93biBsaWdodC48L3A+PHA+QSBjaGVtaWNhbCByZWFjdGlvbiBpbnNpZGUgdGhlaXIgYm9kaWVzIHByb2R1Y2VzIGxpZ2h0IHdpdGhvdXQgaGVhdC4gVGhpcyAiY29sZCBsaWdodCIgaXMgY2FsbGVkIDxzdHJvbmc+QmlvbHVtaW5lc2NlbmNlPC9zdHJvbmc+LCBhbmQgdGhleSB1c2UgaXQgdG8gdGFsayB0byBlYWNoIG90aGVyLjwvcD5gLCBzaW06ICJmaXJlZmxpZXMiIH0sCiAgICAgICAgICAgIHsgdGl0bGU6ICJUaGUgR3JlYXQgTWlncmF0aW9uIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5NYW55IGFuaW1hbHMgdHJhdmVsIHRob3VzYW5kcyBvZiBtaWxlcyBldmVyeSB5ZWFyIGluIGEgam91cm5leSBjYWxsZWQgPHN0cm9uZz5NaWdyYXRpb248L3N0cm9uZz4uIEJ1dCBob3cgZG8gdGhleSBrbm93IHdoZXJlIHRvIGdvPzwvcD48cD5CaXJkcywgdHVydGxlcywgYW5kIGV2ZW4gYnV0dGVyZmxpZXMgaGF2ZSBhbiBhbWF6aW5nIGludGVybmFsIGNvbXBhc3MuIFRoZXkgY2FuIHNlbnNlIHRoZSBFYXJ0aCdzIG1hZ25ldGljIGZpZWxkIGFuZCB1c2UgaXQsIGFsb25nIHdpdGggdGhlIHN1biBhbmQgc3RhcnMsIHRvIG5hdmlnYXRlLjwvcD5gLCBzaW06ICJtaWdyYXRpb24iIH0sCgogICAgICAgICAgICAvLyAtLS0gR0VPTE9HWSAmIENIRU1JU1RSWSAtLS0KICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBDcnlzdGFsJ3MgU2VjcmV0IiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5ObyB0d28gc25vd2ZsYWtlcyBhcmUgZXhhY3RseSBhbGlrZSwgYnV0IHRoZXkgYWxsIGhhdmUgc2l4IHNpZGVzLiBUaGlzIGlzIGJlY2F1c2Ugd2F0ZXIgbW9sZWN1bGVzIGFycmFuZ2UgdGhlbXNlbHZlcyBpbiBhIGhleGFnb25hbCAoc2l4LXNpZGVkKSBsYXR0aWNlIGFzIHRoZXkgZnJlZXplLjwvcD48cD5BcyBhIHRpbnkgaWNlIGNyeXN0YWwgZmFsbHMgdGhyb3VnaCB0aGUgY2xvdWRzLCBtb3JlIHdhdGVyIHZhcG9yIGZyZWV6ZXMgb250byBpdHMgYXJtcywgY3JlYXRpbmcgaXRzIHVuaXF1ZSBhbmQgYmVhdXRpZnVsIHBhdHRlcm4uPC9wPmAsIHNpbTogInNub3dmbGFrZSIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBTdG9uZSBTdG9yeWJvb2siLCB0ZXh0OiBgPHAgY2xhc3M9Im1iLTQiPkxvbmcgYWdvLCB3aGVuIGEgZGlub3NhdXIgZGllZCBuZWFyIGEgcml2ZXIsIGl0cyBib25lcyB3ZXJlIHF1aWNrbHkgYnVyaWVkIGJ5IG11ZCBhbmQgc2FuZC4gT3ZlciBtaWxsaW9ucyBvZiB5ZWFycywgdGhlIG11ZCB0dXJuZWQgdG8gcm9jaywgYW5kIG1pbmVyYWxzIHNlZXBlZCBpbnRvIHRoZSBib25lcywgdHVybmluZyB0aGVtIHRvIHN0b25lLjwvcD48cD5UaGlzIGNyZWF0ZXMgYSA8c3Ryb25nPkZvc3NpbDwvc3Ryb25nPiwgYSBwZXJmZWN0IHN0b25lIGNvcHkgdGhhdCB0ZWxscyB1cyBhIHN0b3J5IGFib3V0IGFuY2llbnQgbGlmZS48L3A+YCwgc2ltOiAiZm9zc2lsIiB9LAogICAgICAgICAgICB7IHRpdGxlOiAiVGhlIERyaXBwaW5nIFNjdWxwdG9yIiwgdGV4dDogYDxwIGNsYXNzPSJtYi00Ij5EZWVwIHVuZGVyZ3JvdW5kLCByYWlud2F0ZXIgc2VlcHMgdGhyb3VnaCBsaW1lc3RvbmUgcm9jaywgZGlzc29sdmluZyBhIG1pbmVyYWwgY2FsbGVkIGNhbGNpdGUuIEluc2lkZSBhIGNhdmUsIHRoaXMgd2F0ZXIgZHJpcHMgZnJvbSB0aGUgY2VpbGluZy48L3A+PHA+RWFjaCBkcm9wIGxlYXZlcyBhIHRpbnkgZGVwb3NpdCBvZiBjYWxjaXRlIGJlaGluZC4gT3ZlciB0aG91c2FuZHMgb2YgeWVhcnMsIHRoZXNlIGRlcG9zaXRzIGdyb3cgaW50byBhbWF6aW5nIHJvY2sgZm9ybWF0aW9ucyBjYWxsZWQgPHN0cm9uZz5TdGFsYWN0aXRlczwvc3Ryb25nPiAoZnJvbSB0aGUgY2VpbGluZykgYW5kIDxzdHJvbmc+U3RhbGFnbWl0ZXM8L3N0cm9uZz4gKGZyb20gdGhlIGZsb29yKS48L3A+YCwgc2ltOiAiY2F2ZXMiIH0sCiAgICAgICAgICAgIHsgdGl0bGU6ICJUaGUgRW5kbGVzcyBTdG9uZSIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+VGhlIHJvY2tzIGJlbmVhdGggeW91ciBmZWV0IGFyZSBvbiBhbiBlbmRsZXNzIGpvdXJuZXkuIE1vbHRlbiBtYWdtYSBjb29scyBpbnRvIDxzdHJvbmc+SWduZW91czwvc3Ryb25nPiByb2NrLiBXaW5kIGFuZCByYWluIGJyZWFrIGl0IGRvd24gaW50byBzYW5kLCB3aGljaCBoYXJkZW5zIGludG8gPHN0cm9uZz5TZWRpbWVudGFyeTwvc3Ryb25nPiByb2NrLjwvcD48cD5JZiBidXJpZWQgYW5kIGNvb2tlZCBieSBoZWF0IGFuZCBwcmVzc3VyZSwgaXQgdHJhbnNmb3JtcyBpbnRvIDxzdHJvbmc+TWV0YW1vcnBoaWM8L3N0cm9uZz4gcm9jaywgd2hpY2ggY2FuIG1lbHQgYW5kIHN0YXJ0IHRoZSA8c3Ryb25nPlJvY2sgQ3ljbGU8L3N0cm9uZz4gYWxsIG92ZXIgYWdhaW4uPC9wPmAsIHNpbTogInJvY2tDeWNsZSIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBFYXJ0aCdzIEhvdCBCcmVhdGgiLCB0ZXh0OiBgPHAgY2xhc3M9Im1iLTQiPkluIHNvbWUgcGxhY2VzLCB1bmRlcmdyb3VuZCB3YXRlciBnZXRzIHRyYXBwZWQgbmVhciBob3QgbWFnbWEuIFRoZSB3YXRlciBib2lscywgYnV0IHRoZSBwcmVzc3VyZSBmcm9tIHRoZSByb2NrIGFib3ZlIGtlZXBzIGl0IGZyb20gdHVybmluZyB0byBzdGVhbS4gSXQgZ2V0cyBzdXBlcmhlYXRlZCE8L3A+PHA+RXZlbnR1YWxseSwgdGhlIHByZXNzdXJlIGJlY29tZXMgdG9vIGdyZWF0LCBhbmQgYSBjb2x1bW4gb2YgaG90IHdhdGVyIGFuZCBzdGVhbSBlcnVwdHMgaW50byB0aGUgYWlyLiBUaGlzIGlzIGEgPHN0cm9uZz5HZXlzZXI8L3N0cm9uZz4uPC9wPmAsIHNpbTogImdleXNlciIgfSwKCiAgICAgICAgICAgIC8vIC0tLSBQSFlTSUNTIElOIE5BVFVSRSAtLS0KICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBMaWdodC1CZW5kZXIncyBUcmljayIsIHRleHQ6IGA8cCBjbGFzcz0ibWItNCI+SGF2ZSB5b3UgZXZlciBzZWVuIGEgPHN0cm9uZz5SYWluYm93PC9zdHJvbmc+IGFmdGVyIGEgc3Rvcm0/IEl0J3MgYSBiZWF1dGlmdWwgdHJpY2sgb2YgbGlnaHQuIFdoZW4gc3VubGlnaHQgcGFzc2VzIHRocm91Z2ggYSByYWluZHJvcCwgdGhlIHdhdGVyIGFjdHMgbGlrZSBhIHRpbnkgcHJpc20uPC9wPjxwPkl0IGJlbmRzIHRoZSB3aGl0ZSBsaWdodCBhbmQgc3BsaXRzIGl0IGludG8gYWxsIGl0cyBkaWZmZXJlbnQgY29sb3JzLiBUaGlzIGJlbmRpbmcgaXMgY2FsbGVkIDxzdHJvbmc+UmVmcmFjdGlvbjwvc3Ryb25nPiwgYW5kIGl0IHBhaW50cyBhIGNvbG9yZnVsIGFyYyBhY3Jvc3MgdGhlIHNreS48L3A+YCwgc2ltOiAicmFpbmJvdyIgfSwKICAgICAgICAgICAgeyB0aXRsZTogIlRoZSBTdW4ncyBGaWVyeSBCcmVhdGgiLCB0ZXh0OiBgPHAgY2xhc3M9Im1iLTQiPlRoZSBTdW4ncyBzdXJmYWNlIGlzIGEgdGFuZ2xlZCBtZXNzIG9mIHBvd2VyZnVsIG1hZ25ldGljIGZpZWxkcy4gU29tZXRpbWVzLCB0aGVzZSBmaWVsZHMgc25hcCBhbmQgcmVjb25uZWN0LCByZWxlYXNpbmcgYSB0cmVtZW5kb3VzIGJ1cnN0IG9mIGVuZXJneS48L3A+PHA+VGhpcyBleHBsb3Npb24sIGNhbGxlZCBhIDxzdHJvbmc+U29sYXIgRmxhcmU8L3N0cm9uZz4sIHNlbmRzIGEgd2F2ZSBvZiByYWRpYXRpb24gYW5kIGNoYXJnZWQgcGFydGljbGVzIGh1cnRsaW5nIHRocm91Z2ggc3BhY2UgYXQgaW5jcmVkaWJsZSBzcGVlZHMuPC9wPmAsIHNpbTogInNvbGFyRmxhcmUiIH0KICAgICAgICBdOwoKICAgICAgICBjb25zdCBCb29rID0gewogICAgICAgICAgICBwYWdlOiAwLAogICAgICAgICAgICBpbml0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIG5leHQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMucGFnZSA8IFN0b3JpZXMubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZSsrOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhZ2UgPSAwOyAvLyBMb29wIGJhY2sgdG8gdGhlIGJlZ2lubmluZwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5yZW5kZXIoKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgcHJldjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYWdlID4gMCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMucGFnZS0tOwogICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlbmRlcjogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdG9yeSA9IFN0b3JpZXNbdGhpcy5wYWdlXTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdG9yeS10aXRsZScpLnRleHRDb250ZW50ID0gc3RvcnkudGl0bGU7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RvcnktY29udGVudCcpLmlubmVySFRNTCA9IHN0b3J5LnRleHQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tcHJldicpLmRpc2FibGVkID0gdGhpcy5wYWdlID09PSAwOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bi1uZXh0JykuZGlzYWJsZWQgPSBmYWxzZTsgLy8gQWx3YXlzIGVuYWJsZWQgZm9yIGxvb3BpbmcKICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG4tbmV4dCcpLnRleHRDb250ZW50ID0gdGhpcy5wYWdlID09PSBTdG9yaWVzLmxlbmd0aCAtIDEgPyAiUmVzdGFydCBBZHZlbnR1cmUiIDogIk5leHQgQWR2ZW50dXJlIOKGkiI7CgogICAgICAgICAgICAgICAgU2ltdWxhdGlvbnMubG9hZChzdG9yeS5zaW0pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgU2ltdWxhdGlvbnMgPSB7CiAgICAgICAgICAgIGFuaW1JZDogbnVsbCwKICAgICAgICAgICAgY2FudmFzOiBudWxsLAogICAgICAgICAgICBjdHg6IG51bGwsCiAgICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgICBoZWlnaHQ6IDAsCiAgICAgICAgICAgIHN0YXRlOiB7fSwKCiAgICAgICAgICAgIGxvYWQ6IGZ1bmN0aW9uKHR5cGUpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFuaW1JZCkgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5hbmltSWQpOwogICAgICAgICAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2ltLWNhbnZhcycpOwogICAgICAgICAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgdGhpcy5zdGF0ZSA9IHt9OyAvLyBSZXNldCBzdGF0ZSBmb3IgbmV3IHNpbXVsYXRpb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZHByID0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gfHwgMTsKICAgICAgICAgICAgICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNhbnZhcy5wYXJlbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSByZWN0LndpZHRoICogZHByOwogICAgICAgICAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gcmVjdC5oZWlnaHQgKiBkcHI7CiAgICAgICAgICAgICAgICB0aGlzLmN0eC5zY2FsZShkcHIsIGRwcik7CiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gcmVjdC53aWR0aDsKICAgICAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gcmVjdC5oZWlnaHQ7CgogICAgICAgICAgICAgICAgaWYgKHRoaXNbdHlwZV0pIHRoaXNbdHlwZV0uaW5pdCh0aGlzKTsKICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIC0tLSBTSU1VTEFUSU9OIERFRklOSVRJT05TIC0tLQoKICAgICAgICAgICAgc29sYXJTeXN0ZW06IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5wbGFuZXRzID0gW107CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlLnN0YXJzID0gW107CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8MTAwOyBpKyspIHNpbS5zdGF0ZS5zdGFycy5wdXNoKHsgeDogTWF0aC5yYW5kb20oKSAqIHNpbS53aWR0aCwgeTogTWF0aC5yYW5kb20oKSAqIHNpbS5oZWlnaHQsIHNpemU6IE1hdGgucmFuZG9tKCkgKiAyLCBhbHBoYTogTWF0aC5yYW5kb20oKSB9KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2xvcnMgPSBbJyM5Y2EzYWYnLCAnI2Q5NzcwNicsICcjM2I4MmY2JywgJyNlZjQ0NDQnLCAnI2VhYjMwOCcsICcjZjU5ZTBiJ107CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8NjsgaSsrKSBzaW0uc3RhdGUucGxhbmV0cy5wdXNoKHsgcjogNjAgKyBpICogMzUsIHNpemU6IDQgKyBNYXRoLnJhbmRvbSgpICogOCwgc3BlZWQ6IDAuMDIgLSAoaSAqIDAuMDAyKSwgYW5nbGU6IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMiwgY29sb3I6IGNvbG9yc1tpXSwgdHJhaWw6IFtdIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gd2lkdGggLyAyLCBjeSA9IGhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMGYxNzJhJzsgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZmZic7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc3RhcnMuZm9yRWFjaChzID0+IHsgY3R4Lmdsb2JhbEFscGhhID0gcy5hbHBoYSArIE1hdGguc2luKERhdGUubm93KCkvNTAwKSowLjI7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhzLngsIHMueSwgcy5zaXplLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOyB9KTsKICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1blB1bHNlID0gMjAgKyBNYXRoLnNpbihEYXRlLm5vdygpLzMwMCkgKiAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyYWQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoY3gsIGN5LCA1LCBjeCwgY3ksIHN1blB1bHNlICogMik7CiAgICAgICAgICAgICAgICAgICAgZ3JhZC5hZGRDb2xvclN0b3AoMCwgJyNmZmYnKTsgZ3JhZC5hZGRDb2xvclN0b3AoMC4yLCAnI2ZjZDM0ZCcpOyBncmFkLmFkZENvbG9yU3RvcCgxLCAndHJhbnNwYXJlbnQnKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JhZDsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKGN4LCBjeSwgc3VuUHVsc2UgKiAyLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZiYmYyNCc7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhjeCwgY3ksIDE1LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnBsYW5ldHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcC5hbmdsZSArPSBwLnNwZWVkOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gY3ggKyBNYXRoLmNvcyhwLmFuZ2xlKSAqIHAuciwgeSA9IGN5ICsgTWF0aC5zaW4ocC5hbmdsZSkgKiBwLnI7CiAgICAgICAgICAgICAgICAgICAgICAgIHAudHJhaWwucHVzaCh7eCwgeX0pOyBpZiAocC50cmFpbC5sZW5ndGggPiA0MCkgcC50cmFpbC5zaGlmdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5zdHJva2VTdHlsZSA9IHAuY29sb3I7IGN0eC5saW5lV2lkdGggPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBwLnRyYWlsLmZvckVhY2goKHBvcywgaSkgPT4geyBjdHguZ2xvYmFsQWxwaGEgPSBpIC8gNDA7IGlmIChpPT09MCkgY3R4Lm1vdmVUbyhwb3MueCwgcG9zLnkpOyBlbHNlIGN0eC5saW5lVG8ocG9zLngsIHBvcy55KTsgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsgY3R4Lmdsb2JhbEFscGhhID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHAuY29sb3I7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh4LCB5LCBwLnNpemUsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLDAsMCwwLjUpJzsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHgsIHksIHAuc2l6ZSwgcC5hbmdsZSArIE1hdGguUEkvMiwgcC5hbmdsZSAtIE1hdGguUEkvMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2ltLmFuaW1JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmxvb3Aoc2ltKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBwaG90b3N5bnRoZXNpczogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlLnBhcnRpY2xlcyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyYWQgPSBjdHguY3JlYXRlTGluZWFyR3JhZGllbnQoMCwgMCwgMCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBncmFkLmFkZENvbG9yU3RvcCgwLCAnIzg2ZWZhYycpOyBncmFkLmFkZENvbG9yU3RvcCgxLCAnIzIyYzU1ZScpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkOyBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyMxNmEzNGEnOyBjdHgubGluZVdpZHRoID0gMjsKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx3aWR0aDsgaSs9NTApIHsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKGksIDApOyBjdHgubGluZVRvKGkgKyBNYXRoLnNpbihpKSoxMCwgaGVpZ2h0KTsgY3R4LnN0cm9rZSgpOyB9CiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjEpIHN0YXRlLnBhcnRpY2xlcy5wdXNoKHt4OiBNYXRoLnJhbmRvbSgpKndpZHRoLCB5OiAtMTAsIHZ4OiAwLCB2eTogMiArIE1hdGgucmFuZG9tKCksIHR5cGU6ICdzdW4nLCByOiAzfSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjA1KSBzdGF0ZS5wYXJ0aWNsZXMucHVzaCh7eDogLTEwLCB5OiBNYXRoLnJhbmRvbSgpKmhlaWdodCwgdng6IDIsIHZ5OiAoTWF0aC5yYW5kb20oKS0wLjUpLCB0eXBlOiAnY28yJywgcjogNH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wNSkgc3RhdGUucGFydGljbGVzLnB1c2goe3g6IE1hdGgucmFuZG9tKCkqd2lkdGgsIHk6IGhlaWdodCsxMCwgdng6IChNYXRoLnJhbmRvbSgpLTAuNSksIHZ5OiAtMiwgdHlwZTogJ2gybycsIHI6IDR9KTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhdGUucGFydGljbGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwID0gc3RhdGUucGFydGljbGVzW2ldOyBwLnggKz0gcC52eDsgcC55ICs9IHAudnk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gcC54IC0gd2lkdGgvMiwgZHkgPSBwLnkgLSBoZWlnaHQvMjsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGguc3FydChkeCpkeCArIGR5KmR5KSA8IDUwICYmIChwLnR5cGUgPT09ICdzdW4nIHx8IHAudHlwZSA9PT0gJ2NvMicgfHwgcC50eXBlID09PSAnaDJvJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdUeXBlID0gTWF0aC5yYW5kb20oKSA+IDAuNSA/ICdvMicgOiAnc3VnYXInOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucGFydGljbGVzLnB1c2goe3g6IHdpZHRoLzIsIHk6IGhlaWdodC8yLCB2eDogKE1hdGgucmFuZG9tKCktMC41KSoobmV3VHlwZT09PSdvMic/MzoxKSwgdnk6IChNYXRoLnJhbmRvbSgpLTAuNSkqKG5ld1R5cGU9PT0nbzInPzM6MSksIHR5cGU6IG5ld1R5cGUsIHI6IG5ld1R5cGU9PT0nbzInPzU6NiwgbGlmZTogMTAwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC50eXBlID09PSAnc3VuJykgY3R4LmZpbGxTdHlsZSA9ICcjZmFjYzE1JzsgZWxzZSBpZiAocC50eXBlID09PSAnY28yJykgY3R4LmZpbGxTdHlsZSA9ICcjNmI3MjgwJzsgZWxzZSBpZiAocC50eXBlID09PSAnaDJvJykgY3R4LmZpbGxTdHlsZSA9ICcjM2I4MmY2JzsgZWxzZSBpZiAocC50eXBlID09PSAnbzInKSBjdHguZmlsbFN0eWxlID0gJyNiYWU2ZmQnOyBlbHNlIGlmIChwLnR5cGUgPT09ICdzdWdhcicpIGN0eC5maWxsU3R5bGUgPSAnI2ZmZic7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhwLngsIHAueSwgcC5yLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC54IDwgLTIwIHx8IHAueCA+IHdpZHRoKzIwIHx8IHAueSA8IC0yMCB8fCBwLnkgPiBoZWlnaHQrMjApIHN0YXRlLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgyMSwgMTI4LCA2MSwgMC44KSc7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmVsbGlwc2Uod2lkdGgvMiwgaGVpZ2h0LzIsIDYwLCA0MCwgMCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzg2ZWZhYyc7IGN0eC5saW5lV2lkdGggPSAzOyBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmZmJzsgY3R4LmZvbnQgPSAiMTJweCBzYW5zLXNlcmlmIjsgY3R4LnRleHRBbGlnbiA9ICJjZW50ZXIiOyBjdHguZmlsbFRleHQoIkNobG9yb3BsYXN0Iiwgd2lkdGgvMiwgaGVpZ2h0LzIgKyA1KTsKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIGVhcnRocXVha2U6IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgb2Zmc2V0OiAwLCBzaGFrZVRpbWU6IDAsIHNob2Nrd2F2ZXM6IFtdIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29wKHNpbSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9vcDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyBjdHgsIHdpZHRoLCBoZWlnaHQsIHN0YXRlIH0gPSBzaW07CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjODU0ZDBlJzsgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOyAvLyBEaXJ0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc2hha2VUaW1lKys7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNoYWtlVGltZSA+IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5vZmZzZXQgPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyMDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnNoYWtlVGltZSA+IDIwNSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuc2hha2VUaW1lID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zaG9ja3dhdmVzLnB1c2goe3g6IHdpZHRoLzIsIHk6IDE1MCwgcjogMH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUub2Zmc2V0ID0gTWF0aC5zaW4oc3RhdGUuc2hha2VUaW1lICogMC41KSAqIDI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IHBsYXRlcwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ExNjIwNyc7IGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aC8yIC0gMiArIHN0YXRlLm9mZnNldCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM3MTNmMTInOyBjdHguZmlsbFJlY3Qod2lkdGgvMiArIDIgKyBzdGF0ZS5vZmZzZXQsIDAsIHdpZHRoLzIgLSAyLCBoZWlnaHQpOwoKICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IHNob2Nrd2F2ZXMKICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjUpJzsgY3R4LmxpbmVXaWR0aCA9IDM7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gc3RhdGUuc2hvY2t3YXZlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgdyA9IHN0YXRlLnNob2Nrd2F2ZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHcuciArPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gKHcuciAvIDQwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh3LngsIHcueSwgdy5yLCAwLCBNYXRoLlBJKjIpOyBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh3LnIgPiA0MDApIHN0YXRlLnNob2Nrd2F2ZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHZvbGNhbm86IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgcGFydGljbGVzOiBbXSwgbWFnbWFZOiBzaW0uaGVpZ2h0LCBsYXZhOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzZiNzI4MCc7IGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsgLy8gU2t5CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVm9sY2FubyBzaGFwZQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzQ0NDAzYyc7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKDAsIGhlaWdodCk7IGN0eC5saW5lVG8od2lkdGgvMiAtIDUwLCAxMDApOyBjdHgubGluZVRvKHdpZHRoLzIgKyA1MCwgMTAwKTsgY3R4LmxpbmVUbyh3aWR0aCwgaGVpZ2h0KTsgY3R4LmZpbGwoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gTWFnbWEgcmlzaW5nCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm1hZ21hWSA+IDEwMCkgc3RhdGUubWFnbWFZIC09IDAuNTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmOTczMTYnOyBjdHguZmlsbFJlY3Qod2lkdGgvMiAtIDEwLCBzdGF0ZS5tYWdtYVksIDIwLCBoZWlnaHQgLSBzdGF0ZS5tYWdtYVkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBFcnVwdGlvbgogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5tYWdtYVkgPD0gMTAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDU7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucGFydGljbGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHdpZHRoLzIsIHk6IDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2eDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogNCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2eTogLTUgLSBNYXRoLnJhbmRvbSgpICogNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZlOiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IE1hdGgucmFuZG9tKCkgPiAwLjMgPyAnIzU3NTM0ZScgOiAnI2Y1OWUwYicKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBMYXZhCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKE1hdGgucmFuZG9tKCkgPCAwLjMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmxhdmEucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogd2lkdGgvMiArIChNYXRoLnJhbmRvbSgpLTAuNSkqNDAsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IDEwMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgTGF2YQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2VmNDQ0NCc7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpID0gc3RhdGUubGF2YS5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgbCA9IHN0YXRlLmxhdmFbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGwueCArPSBsLnggPCB3aWR0aC8yID8gLTAuNSA6IDAuNTsgLy8gRmxvdyBkb3duIHNpZGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGwueSArPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMobC54LCBsLnksIDQsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGwueSA+IGhlaWdodCkgc3RhdGUubGF2YS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBQYXJ0aWNsZXMKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSBzdGF0ZS5wYXJ0aWNsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBzdGF0ZS5wYXJ0aWNsZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHAueCArPSBwLnZ4OyBwLnkgKz0gcC52eTsgcC52eSArPSAwLjE7IC8vIEdyYXZpdHkKICAgICAgICAgICAgICAgICAgICAgICAgcC5saWZlLS07CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBwLmNvbG9yOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBwLmxpZmUgLyAxMDA7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhwLngsIHAueSwgNSwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHAubGlmZSA8PSAwKSBzdGF0ZS5wYXJ0aWNsZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIHdhdGVyQ3ljbGU6IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgcGFydGljbGVzOiBbXSwgY2xvdWRTaXplOiAyMCB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzdkZDNmYyc7IGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsgLy8gU2t5CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDc1OTg1JzsgY3R4LmZpbGxSZWN0KDAsIGhlaWdodCAtIDUwLCB3aWR0aCwgNTApOyAvLyBXYXRlcgogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZjZDM0ZCc7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyg1MCwgNTAsIDMwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOyAvLyBTdW4KCiAgICAgICAgICAgICAgICAgICAgLy8gRXZhcG9yYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuNSkgc3RhdGUucGFydGljbGVzLnB1c2goeyB4OiBNYXRoLnJhbmRvbSgpICogd2lkdGgsIHk6IGhlaWdodCAtIDUwLCB0eXBlOiAndmFwb3InLCB2eDogKE1hdGgucmFuZG9tKCktMC41KSowLjUsIHZ5OiAtMSB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBDb25kZW5zYXRpb24gJiBQcmVjaXBpdGF0aW9uCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmNsb3VkU2l6ZSA+IDgwICYmIE1hdGgucmFuZG9tKCkgPCAwLjUpIHN0YXRlLnBhcnRpY2xlcy5wdXNoKHsgeDogd2lkdGgvMiAtIDQwICsgTWF0aC5yYW5kb20oKSo4MCwgeTogMTAwLCB0eXBlOiAncmFpbicsIHZ5OiA1IH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyBDbG91ZAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsb3VkQ29sb3IgPSBNYXRoLmZsb29yKDI1NSAtIHN0YXRlLmNsb3VkU2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2IoJHtjbG91ZENvbG9yfSwke2Nsb3VkQ29sb3J9LCR7Y2xvdWRDb2xvcn0pYDsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMod2lkdGgvMiwgMTAwLCBzdGF0ZS5jbG91ZFNpemUsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHdpZHRoLzItNDAsIDEwMCwgc3RhdGUuY2xvdWRTaXplKjAuOCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMod2lkdGgvMis0MCwgMTAwLCBzdGF0ZS5jbG91ZFNpemUqMC44LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBQYXJ0aWNsZXMKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSBzdGF0ZS5wYXJ0aWNsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBzdGF0ZS5wYXJ0aWNsZXNbaV07IHAueCArPSBwLnZ4IHx8IDA7IHAueSArPSBwLnZ5OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC50eXBlID09PSAndmFwb3InKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LDI1NSwyNTUsMC4zKSc7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhwLngsIHAueSwgMywgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwLnkgPCAxMjApIHsgc3RhdGUucGFydGljbGVzLnNwbGljZShpLCAxKTsgaWYoc3RhdGUuY2xvdWRTaXplIDwgMTAwKSBzdGF0ZS5jbG91ZFNpemUgKz0gMC41OyB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocC50eXBlID09PSAncmFpbicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjMGVhNWU5JzsgY3R4LmxpbmVXaWR0aCA9IDI7IGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbyhwLngsIHAueSk7IGN0eC5saW5lVG8ocC54LCBwLnktMTApOyBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocC55ID4gaGVpZ2h0IC0gNTApIHsgc3RhdGUucGFydGljbGVzLnNwbGljZShpLCAxKTsgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgbGlnaHRuaW5nOiB7CiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IHNpbTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjaXR5c2NhcGVQYXRoID0gbmV3IFBhdGgyRCgpOwogICAgICAgICAgICAgICAgICAgIGNpdHlzY2FwZVBhdGgubW92ZVRvKDAsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgY2l0eXNjYXBlUGF0aC5saW5lVG8oMCwgaGVpZ2h0IC0gNDApOwoKICAgICAgICAgICAgICAgICAgICAvLyBHZW5lcmF0ZSBhIGphZ2dlZCBjaXR5IHNreWxpbmUgd2l0aCB0cmVlcyBvbmNlCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCArPSAyMCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBidWlsZGluZ0hlaWdodCA9IDQwICsgTWF0aC5yYW5kb20oKSAqIDgwOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0cmVlSGVpZ2h0ID0gMzAgKyBNYXRoLnJhbmRvbSgpICogNDA7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA+IDAuNCkgeyAvLyBCdWlsZGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2l0eXNjYXBlUGF0aC5saW5lVG8oeCwgaGVpZ2h0IC0gYnVpbGRpbmdIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2l0eXNjYXBlUGF0aC5saW5lVG8oeCArIDIwLCBoZWlnaHQgLSBidWlsZGluZ0hlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIFRyZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpdHlzY2FwZVBhdGgubGluZVRvKHgsIGhlaWdodCAtIDQwKTsgLy8gYmFjayB0byBncm91bmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNpdHlzY2FwZVBhdGgubGluZVRvKHggKyAxMCwgaGVpZ2h0IC0gNDAgLSB0cmVlSGVpZ2h0KTsgLy8gcGVhayBvZiB0cmVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXR5c2NhcGVQYXRoLmxpbmVUbyh4ICsgMjAsIGhlaWdodCAtIDQwKTsgLy8gYmFjayB0byBncm91bmQKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjaXR5c2NhcGVQYXRoLmxpbmVUbyh3aWR0aCwgaGVpZ2h0IC0gNDApOwogICAgICAgICAgICAgICAgICAgIGNpdHlzY2FwZVBhdGgubGluZVRvKHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGNpdHlzY2FwZVBhdGguY2xvc2VQYXRoKCk7CgogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgYm9sdDogbnVsbCwgdGltZTogMCwgY2l0eXNjYXBlUGF0aDogY2l0eXNjYXBlUGF0aCB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzFlMjkzYic7IGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsgLy8gTmlnaHQgc2t5CgogICAgICAgICAgICAgICAgICAgIC8vIEdyb3VuZCBhbmQgQ2l0eXNjYXBlIFNpbGhvdWV0dGUKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwYzBhMDknOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKHN0YXRlLmNpdHlzY2FwZVBhdGgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENsb3VkCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjNDc1NTY5JzsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5lbGxpcHNlKHdpZHRoLzIsIDgwLCAxNTAsIDUwLCAwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgICAgICBzdGF0ZS50aW1lKys7CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnRpbWUgPiAxNTAgJiYgIXN0YXRlLmJvbHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGJvbHQKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuYm9sdCA9IFt7eDogd2lkdGgvMiwgeTogMTMwfV07CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDEwOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsYXN0ID0gc3RhdGUuYm9sdFtzdGF0ZS5ib2x0Lmxlbmd0aC0xXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmJvbHQucHVzaCh7eDogbGFzdC54ICsgKE1hdGgucmFuZG9tKCktMC41KSo0MCwgeTogbGFzdC55ICsgMjAgKyBNYXRoLnJhbmRvbSgpKjIwfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnRpbWUgPiAxNjApIHsgc3RhdGUuYm9sdCA9IG51bGw7IHN0YXRlLnRpbWUgPSAwOyB9CgogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgYm9sdAogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5ib2x0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjZmVmMDhhJzsgY3R4LmxpbmVXaWR0aCA9IDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dDb2xvciA9ICcjZmVmMDhhJzsgY3R4LnNoYWRvd0JsdXIgPSAyMDsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5ib2x0LmZvckVhY2goKHAsIGkpID0+IHsgaWYoaT09PTApIGN0eC5tb3ZlVG8ocC54LCBwLnkpOyBlbHNlIGN0eC5saW5lVG8ocC54LCBwLnkpOyB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBjaGFyZ2VzIGJ1aWxkaW5nIHVwCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2Y4NzE3MSc7IGN0eC5mb250ID0gJ2JvbGQgMTZweCBzYW5zLXNlcmlmJzsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8MTA7IGkrKykgY3R4LmZpbGxUZXh0KCcrJywgd2lkdGgvMiAtIDEwMCArIE1hdGgucmFuZG9tKCkqMjAwLCA2MCArIE1hdGgucmFuZG9tKCkqMjApOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM2MGE1ZmEnOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwxMDsgaSsrKSBjdHguZmlsbFRleHQoJy0nLCB3aWR0aC8yIC0gMTAwICsgTWF0aC5yYW5kb20oKSoyMDAsIDEwMCArIE1hdGgucmFuZG9tKCkqMjApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKCiAgICAgICAgICAgIC8vIC0tLSBIZWxwZXIgZm9yIG90aGVyIHNpbXMgLS0tCiAgICAgICAgICAgIGNyZWF0ZVBhcnRpY2xlczogZnVuY3Rpb24oc2ltLCBjb3VudCkgewogICAgICAgICAgICAgICAgc2ltLnN0YXRlLnBhcnRpY2xlcyA9IFtdOwogICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8Y291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5wYXJ0aWNsZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucmFuZG9tKCkgKiBzaW0ud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IE1hdGgucmFuZG9tKCkgKiBzaW0uaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICB2eDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMiwKICAgICAgICAgICAgICAgICAgICAgICAgdnk6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIHI6IE1hdGgucmFuZG9tKCkgKiAzICsgMSwKICAgICAgICAgICAgICAgICAgICAgICAgbGlmZTogMQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgLy8gLS0tIFBsYWNlaG9sZGVyIGZvciBvdGhlciAxOSBzdG9yaWVzIC0tLQogICAgICAgICAgICBteWNlbGl1bTogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyBub2RlczogW10sIHB1bHNlczogW10gfTsKICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgdHJlZSByb290cy9ub2RlcwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDY7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUubm9kZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiA0MCArIGkgKiAoc2ltLndpZHRoIC8gNikgKyBNYXRoLnJhbmRvbSgpKjMwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogMjgwICsgTWF0aC5yYW5kb20oKSAqIDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25zOiBbXQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gQ29ubmVjdCBub2RlcwogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5ub2Rlcy5mb3JFYWNoKChuLCBpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5ub2Rlcy5mb3JFYWNoKChuMiwgaikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydCgobi54LW4yLngpKioyICsgKG4ueS1uMi55KSoqMik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPT0gaiAmJiBkaXN0IDwgMjAwICYmIE1hdGgucmFuZG9tKCkgPCAwLjUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmNvbm5lY3Rpb25zLnB1c2gobjIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGN0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGUgfSA9IHNpbTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMzZjJlMjYnOyAvLyBEYXJrIHNvaWwKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgUm9vdHMvTm9kZXMKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5ub2Rlcy5mb3JFYWNoKG4gPT4gewogICAgICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IHJvb3QgZ29pbmcgdXAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJyM4YjZiNWQnOyBjdHgubGluZVdpZHRoID0gNjsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKG4ueCwgbi55KTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKG4ueCArIChNYXRoLnJhbmRvbSgpLTAuNSkqMTAsIG4ueS8yLCBuLngsIDApOyAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjYTg4ZDdiJzsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKG4ueCwgbi55LCA2LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IE15Y2VsaXVtIFRocmVhZHMKICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpJzsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5ub2Rlcy5mb3JFYWNoKG4gPT4gewogICAgICAgICAgICAgICAgICAgICAgICBuLmNvbm5lY3Rpb25zLmZvckVhY2gobjIgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKG4ueCwgbi55KTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjeCA9IChuLnggKyBuMi54KSAvIDI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjeSA9IChuLnkgKyBuMi55KSAvIDIgKyAzMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKGN4LCBjeSwgbjIueCwgbjIueSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyBTcGF3biBQdWxzZXMgKFNpZ25hbHMpCiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhcnROb2RlID0gc3RhdGUubm9kZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc3RhdGUubm9kZXMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFydE5vZGUuY29ubmVjdGlvbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kTm9kZSA9IHN0YXJ0Tm9kZS5jb25uZWN0aW9uc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzdGFydE5vZGUuY29ubmVjdGlvbnMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5wdWxzZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0Tm9kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQ6IGVuZE5vZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDAuMDIgKyBNYXRoLnJhbmRvbSgpICogMC4wMgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBQdWxzZXMKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM4NmVmYWMnOyAvLyBHbG93aW5nIGdyZWVuIHNpZ25hbAogICAgICAgICAgICAgICAgICAgIGN0eC5zaGFkb3dDb2xvciA9ICcjODZlZmFjJzsgY3R4LnNoYWRvd0JsdXIgPSA1OwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGF0ZS5wdWxzZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBzdGF0ZS5wdWxzZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHAucHJvZ3Jlc3MgKz0gcC5zcGVlZDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBwLnN0YXJ0OwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuMiA9IHAuZW5kOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjeCA9IChuLnggKyBuMi54KSAvIDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gKG4ueSArIG4yLnkpIC8gMiArIDMwOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IHAucHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGludlQgPSAxIC0gdDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IGludlQgKiBpbnZUICogbi54ICsgMiAqIGludlQgKiB0ICogY3ggKyB0ICogdCAqIG4yLng7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBpbnZUICogaW52VCAqIG4ueSArIDIgKiBpbnZUICogdCAqIGN5ICsgdCAqIHQgKiBuMi55OwoKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHgsIHksIDIsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5wcm9ncmVzcyA+PSAxKSBzdGF0ZS5wdWxzZXMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHguc2hhZG93Qmx1ciA9IDA7CgogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICAKICAgICAgICAgICAgYXVyb3JhOiB7CiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUgPSB7IHQ6IDAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGN0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGUgfSA9IHNpbTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS50ICs9IDAuMDI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQmFja2dyb3VuZAogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzBmMTcyYSc7IGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBTdGFycwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2ZmZic7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8NTA7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB4ID0gKE1hdGguc2luKGkqMTIzKSoxMDAwMCkgJSB3aWR0aDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSAoTWF0aC5jb3MoaSo0NTYpKjEwMDAwKSAlIGhlaWdodDsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMC41ICsgMC41ICogTWF0aC5zaW4oc3RhdGUudCArIGkpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoTWF0aC5hYnMoeCksIE1hdGguYWJzKHkpLCAxLjUsIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICAgICAgICAgIC8vIEF1cm9yYSBDdXJ0YWlucwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRyYXdDdXJ0YWluID0gKGNvbG9yLCBvZmZzZXQsIHNwZWVkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBjb2xvcjsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKDAsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDw9IHdpZHRoOyB4ICs9IDEwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB5ID0gNTAgKyBNYXRoLnNpbih4ICogMC4wMSArIHN0YXRlLnQgKiBzcGVlZCArIG9mZnNldCkgKiA1MCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBNYXRoLnNpbih4ICogMC4wMiArIHN0YXRlLnQgKiAwLjUpICogMzA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKHgsIHkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8od2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzY3JlZW4nOyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBncmFkMSA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGdyYWQxLmFkZENvbG9yU3RvcCgwLCAncmdiYSg3NCwgMjIyLCAxMjgsIDApJyk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZDEuYWRkQ29sb3JTdG9wKDAuMywgJ3JnYmEoNzQsIDIyMiwgMTI4LCAwLjYpJyk7IAogICAgICAgICAgICAgICAgICAgIGdyYWQxLmFkZENvbG9yU3RvcCgxLCAncmdiYSg3NCwgMjIyLCAxMjgsIDApJyk7CiAgICAgICAgICAgICAgICAgICAgZHJhd0N1cnRhaW4oZ3JhZDEsIDAsIDEpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBncmFkMiA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGdyYWQyLmFkZENvbG9yU3RvcCgwLCAncmdiYSgxNjgsIDg1LCAyNDcsIDApJyk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZDIuYWRkQ29sb3JTdG9wKDAuNCwgJ3JnYmEoMTY4LCA4NSwgMjQ3LCAwLjUpJyk7IAogICAgICAgICAgICAgICAgICAgIGdyYWQyLmFkZENvbG9yU3RvcCgxLCAncmdiYSgxNjgsIDg1LCAyNDcsIDApJyk7CiAgICAgICAgICAgICAgICAgICAgZHJhd0N1cnRhaW4oZ3JhZDIsIDIsIDEuNSk7CiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3Zlcic7CgogICAgICAgICAgICAgICAgICAgIC8vIE1vdW50YWlucwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAyMDYxNyc7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKDAsIGhlaWdodCk7IGN0eC5saW5lVG8oMCwgaGVpZ2h0IC0gNjApOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8od2lkdGgqMC4zLCBoZWlnaHQgLSAxNTApOyBjdHgubGluZVRvKHdpZHRoKjAuNiwgaGVpZ2h0IC0gODApOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8od2lkdGgsIGhlaWdodCAtIDEzMCk7IGN0eC5saW5lVG8od2lkdGgsIGhlaWdodCk7IGN0eC5maWxsKCk7CgogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgdGlkZXM6IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgdGltZTogMCB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnRpbWUgKz0gMC4wMDU7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSBTa3kgYW5kIENlbGVzdGlhbCBCb2R5IC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNreUNvbG9yID0gYGhzbCgyMTAsIDUwJSwgJHs1MCArIDQwICogTWF0aC5zaW4oc3RhdGUudGltZSl9KWA7IC8vIERheS9uaWdodCBjeWNsZQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBza3lDb2xvcjsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICAgICAgICAgIC8vIE1vb24vU3VuCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9keVggPSAoc3RhdGUudGltZSAqIDUwKSAlICh3aWR0aCArIDEwMCkgLSA1MDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBib2R5WSA9IGhlaWdodCAvIDIgLSBNYXRoLnNpbigoYm9keVggKyA1MCkgLyAod2lkdGggKyAxMDApICogTWF0aC5QSSkgKiAoaGVpZ2h0IC8gMiAtIDIwKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpc01vb24gPSBNYXRoLnNpbihzdGF0ZS50aW1lKSA8IDA7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGlzTW9vbiA/ICcjZTJlOGYwJyA6ICcjZmNkMzRkJzsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhib2R5WCwgYm9keVksIDIwLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIFdhdGVyIGFuZCBMYW5kIC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxhbmRIZWlnaHQgPSA4MDsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmNTllMGInOyAvLyBTYW5keSBjb2xvcgogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKDAsIGhlaWdodCAtIGxhbmRIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKHdpZHRoICogMC4zLCBoZWlnaHQgLSBsYW5kSGVpZ2h0IC0gMjAsIHdpZHRoICogMC43LCBoZWlnaHQgLSBsYW5kSGVpZ2h0ICsgMjAsIHdpZHRoLCBoZWlnaHQgLSBsYW5kSGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oMCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVGlkZSBsZXZlbCBiYXNlZCBvbiB0aW1lIChsaW5rZWQgdG8gY2VsZXN0aWFsIGJvZHkgcG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGlkZUxldmVsID0gKGhlaWdodCAtIGxhbmRIZWlnaHQgLSAxMCkgKyBNYXRoLmNvcyhzdGF0ZS50aW1lICogMikgKiAzMDsgLy8gSGlnaCB0aWRlIHdoZW4gYm9keSBpcyBvdmVyaGVhZC91bmRlcmZvb3QKCiAgICAgICAgICAgICAgICAgICAgLy8gV2F0ZXIKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoNTksIDEzMCwgMjQ2LCAwLjcpJzsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbygwLCB0aWRlTGV2ZWwpOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKHgsIHRpZGVMZXZlbCArIE1hdGguc2luKHggKiAwLjA1ICsgc3RhdGUudGltZSAqIDUpICogMyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8od2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygwLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgCiAgICAgICAgICAgIHNub3dmbGFrZTogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyBsZW46IDAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7Y3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZX0gPSBzaW07CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMWUzYThhJzsgY3R4LmZpbGxSZWN0KDAsMCx3aWR0aCxoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGlmKHN0YXRlLmxlbiA8IDEwMCkgc3RhdGUubGVuICs9IDAuNTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCBkcmF3Rmxha2UgPSAoeCwgeSwgc2NhbGUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh4LCB5KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjZmZmJzsgY3R4LmxpbmVXaWR0aCA9IDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDY7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShNYXRoLlBJLzMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKDAsMCk7IGN0eC5saW5lVG8oMCwgc3RhdGUubGVuKTsgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3RhdGUubGVuID4gMjApIHsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKDAsIDIwKTsgY3R4LmxpbmVUbygxMCwgMzApOyBjdHguc3Ryb2tlKCk7IGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbygwLCAyMCk7IGN0eC5saW5lVG8oLTEwLCAzMCk7IGN0eC5zdHJva2UoKTsgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc3RhdGUubGVuID4gNTApIHsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKDAsIDUwKTsgY3R4LmxpbmVUbygyMCwgNzApOyBjdHguc3Ryb2tlKCk7IGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbygwLCA1MCk7IGN0eC5saW5lVG8oLTIwLCA3MCk7IGN0eC5zdHJva2UoKTsgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAgICAgZHJhd0ZsYWtlKHdpZHRoLzIgLSA4MCwgaGVpZ2h0LzIgLSA4MCwgMSk7CiAgICAgICAgICAgICAgICAgICAgZHJhd0ZsYWtlKHdpZHRoLzIgKyAxMjAsIGhlaWdodC8yICsgODAsIDAuNyk7CgogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAoKICAgICAgICAgICAgcmFpbmJvdzogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyB0OiAwIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29wKHNpbSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9vcDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qge2N0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGV9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnQgKz0gMC4wMTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBEYXJrIGJhY2tncm91bmQgZm9yIHNwZWN0cnVtIHZpc2liaWxpdHkKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMxMTE4MjcnOyAKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gd2lkdGggLyAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gaGVpZ2h0IC8gMjsKCiAgICAgICAgICAgICAgICAgICAgLy8gUHJpc20gKEVxdWlsYXRlcmFsIFRyaWFuZ2xlKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSAxMjA7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaFRyaSA9IHNpemUgKiBNYXRoLnNxcnQoMykgLyAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAxID0ge3g6IGN4LCB5OiBjeSAtIGhUcmkvMiAtIDIwfTsgLy8gVG9wCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcDIgPSB7eDogY3ggLSBzaXplLzIsIHk6IGN5ICsgaFRyaS8yIC0gMjB9OyAvLyBCb3R0b20gTGVmdAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAzID0ge3g6IGN4ICsgc2l6ZS8yLCB5OiBjeSArIGhUcmkvMiAtIDIwfTsgLy8gQm90dG9tIFJpZ2h0CgogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgUHJpc20KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4wNSknOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMyknOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAyOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKHAxLngsIHAxLnkpOwogICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8ocDIueCwgcDIueSk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhwMy54LCBwMy55KTsKICAgICAgICAgICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIEluY29taW5nIFdoaXRlIExpZ2h0CiAgICAgICAgICAgICAgICAgICAgLy8gSGl0IHRoZSBsZWZ0IHNpZGUgKHAxLXAyKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudHJ5VCA9IDAuNiArIE1hdGguc2luKHN0YXRlLnQpICogMC4xOyAvLyBPc2NpbGxhdGUgaGl0IHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50cnlYID0gcDEueCArIChwMi54IC0gcDEueCkgKiBlbnRyeVQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW50cnlZID0gcDEueSArIChwMi55IC0gcDEueSkgKiBlbnRyeVQ7CgogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjZmZmZmZmJzsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gNDsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbygwLCBlbnRyeVkgKyA1MCk7IC8vIENvbWluZyBmcm9tIGxlZnQtaXNoCiAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhlbnRyeVgsIGVudHJ5WSk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBTcGVjdHJ1bQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9ycyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgJyNmZjAwMDAnLCAnI2ZmN2YwMCcsICcjZmZmZjAwJywgJyMwMGZmMDAnLCAnIzAwMDBmZicsICcjNGIwMDgyJywgJyM5NDAwZDMnCiAgICAgICAgICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICAgICAgICAgY29sb3JzLmZvckVhY2goKGNvbCwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSBjb2w7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSA1OwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAwLjg7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWZyYWN0aW9uIGluc2lkZSAoaGl0IHJpZ2h0IHNpZGUgcDEtcDMpCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZha2UgcGh5c2ljczogc3ByZWFkIHRoZW0gb3V0IGJhc2VkIG9uIGluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXRUID0gZW50cnlUICsgMC4xICsgKGkgKiAwLjAxNSk7IC8vIExvd2VyIGRvd24gb24gcmlnaHQgc2lkZQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpdFggPSBwMS54ICsgKHAzLnggLSBwMS54KSAqIGV4aXRUOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleGl0WSA9IHAxLnkgKyAocDMueSAtIHAxLnkpICogZXhpdFQ7CgogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oZW50cnlYLCBlbnRyeVkpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKGV4aXRYLCBleGl0WSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV4aXQgcmVmcmFjdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFggPSB3aWR0aDsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxZID0gZXhpdFkgKyAoZXhpdFkgLSBlbnRyeVkpICogMiArIChpICogMzApOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKGV4aXRYLCBleGl0WSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oZmluYWxYLCBmaW5hbFkpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgICAgICAgICAgLy8gTGFiZWwKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmYnOwogICAgICAgICAgICAgICAgICAgIGN0eC5mb250ID0gJzE0cHggc2Fucy1zZXJpZic7CiAgICAgICAgICAgICAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsVGV4dCgiUHJpc20gUmVmcmFjdGlvbiIsIGN4LCBjeSArIDEwMCk7CgogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBwb2xsaW5hdGlvbjogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyBiZWU6IHt4OiA1MCwgeTogMTAwLCB0YXJnZXQ6IDB9LCBmbG93ZXJzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDM7IGkrKykgc2ltLnN0YXRlLmZsb3dlcnMucHVzaCh7eDogMTAwICsgaSoxNTAsIHk6IDMwMH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHtjdHgsIHdpZHRoLCBoZWlnaHQsIHN0YXRlfSA9IHNpbTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM4N0NFRUInOyBjdHguZmlsbFJlY3QoMCwwLHdpZHRoLGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmxvd2Vycy5mb3JFYWNoKGYgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMyMjhCMjInOyBjdHguZmlsbFJlY3QoZi54LTIsIGYueSwgNCwgNTApOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNGRjY5QjQnOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoZi54LCBmLnksIDE1LCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNGRkQ3MDAnOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoZi54LCBmLnksIDUsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0ID0gc3RhdGUuZmxvd2Vyc1tzdGF0ZS5iZWUudGFyZ2V0XTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHRhcmdldC54IC0gc3RhdGUuYmVlLngsIGR5ID0gKHRhcmdldC55IC0gMjApIC0gc3RhdGUuYmVlLnk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKICAgICAgICAgICAgICAgICAgICBpZihkaXN0IDwgNSkgc3RhdGUuYmVlLnRhcmdldCA9IChzdGF0ZS5iZWUudGFyZ2V0ICsgMSkgJSBzdGF0ZS5mbG93ZXJzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICBlbHNlIHsgc3RhdGUuYmVlLnggKz0gKGR4L2Rpc3QpKjI7IHN0YXRlLmJlZS55ICs9IChkeS9kaXN0KSoyOyB9CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjRkZENzAwJzsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHN0YXRlLmJlZS54LCBzdGF0ZS5iZWUueSwgOCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMwMDAnOyBjdHguZmlsbFJlY3Qoc3RhdGUuYmVlLngtMiwgc3RhdGUuYmVlLnktOCwgNCwgMTYpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsMjU1LDI1NSwwLjcpJzsgY3R4LmJlZ2luUGF0aCgpOyBjdHguZWxsaXBzZShzdGF0ZS5iZWUueC01LCBzdGF0ZS5iZWUueS01LCA4LCA0LCBNYXRoLnNpbihEYXRlLm5vdygpLzUwKSwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5lbGxpcHNlKHN0YXRlLmJlZS54KzUsIHN0YXRlLmJlZS55LTUsIDgsIDQsIC1NYXRoLnNpbihEYXRlLm5vdygpLzUwKSwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWV0YW1vcnBob3NpczogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyBzdGFnZTogMCwgdGltZXI6IDAsIHg6IDUwIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29wKHNpbSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9vcDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qge2N0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGV9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzcyOEZDRSc7IGN0eC5maWxsUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gV2lsZCBwbGFudHMgYXQgdGhlIGJvdHRvbQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBEYXRlLm5vdygpIC8gNTAwOwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPHdpZHRoOyBpKz0xNSkgewogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMyMmM1NWUnOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoID0gNDAgKyBNYXRoLnNpbihpKjAuMSArIHRpbWUpKjEwOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oaSwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oaSs1LCBoZWlnaHQtaC8yLCBpICsgTWF0aC5zaW4odGltZSoyICsgaSkqNSwgaGVpZ2h0LWgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVRvKGkrMTAsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzhCNDUxMyc7IGN0eC5saW5lV2lkdGggPSAxMDsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKDAsIDIwMCk7IGN0eC5saW5lVG8od2lkdGgsIDIwMCk7IGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS50aW1lcisrOwogICAgICAgICAgICAgICAgICAgIGlmKHN0YXRlLnRpbWVyID4gMjAwKSB7IHN0YXRlLnN0YWdlID0gKHN0YXRlLnN0YWdlICsgMSkgJSA0OyBzdGF0ZS50aW1lciA9IDA7IHN0YXRlLnggPSA1MDsgfQogICAgICAgICAgICAgICAgICAgIGlmKHN0YXRlLnN0YWdlID09PSAwKSB7IGN0eC5maWxsU3R5bGUgPSAnI2ZmZic7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh3aWR0aC8yLCAxOTUsIDUsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7IGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7IGN0eC5maWxsVGV4dCgiRWdnIiwgd2lkdGgvMi0xMCwgMTgwKTsgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYoc3RhdGUuc3RhZ2UgPT09IDEpIHsgc3RhdGUueCArPSAwLjU7IGN0eC5maWxsU3R5bGUgPSAnIzdDRkMwMCc7IGZvcihsZXQgaT0wOyBpPDU7IGkrKykgeyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoc3RhdGUueCArIGkqMTAsIDE5MCArIE1hdGguc2luKHN0YXRlLnRpbWVyKjAuMiArIGkpKjIsIDYsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7IH0gY3R4LmZpbGxTdHlsZSA9ICcjMDAwJzsgY3R4LmZpbGxUZXh0KCJMYXJ2YSIsIHN0YXRlLngsIDE3MCk7IH0KICAgICAgICAgICAgICAgICAgICBlbHNlIGlmKHN0YXRlLnN0YWdlID09PSAyKSB7IGN0eC5maWxsU3R5bGUgPSAnIzhGQkM4Ric7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmVsbGlwc2Uod2lkdGgvMiwgMjEwLCAxMCwgMjAsIDAsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7IGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7IGN0eC5maWxsVGV4dCgiUHVwYSIsIHdpZHRoLzItMTUsIDI0MCk7IH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsgc3RhdGUueCArPSAyOyBjb25zdCB5ID0gMTUwICsgTWF0aC5zaW4oc3RhdGUudGltZXIqMC4xKSozMDsgY3R4LmZpbGxTdHlsZSA9ICcjRkZBNTAwJzsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKHN0YXRlLngsIHkpOyBjdHgubGluZVRvKHN0YXRlLngtMTUsIHktMTUpOyBjdHgubGluZVRvKHN0YXRlLngtMTUsIHkrMTUpOyBjdHguZmlsbCgpOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8oc3RhdGUueCwgeSk7IGN0eC5saW5lVG8oc3RhdGUueCsxNSwgeS0xNSk7IGN0eC5saW5lVG8oc3RhdGUueCsxNSwgeSsxNSk7IGN0eC5maWxsKCk7IGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7IGN0eC5maWxsUmVjdChzdGF0ZS54LTIsIHktMTAsIDQsIDIwKTsgY3R4LmZpbGxUZXh0KCJCdXR0ZXJmbHkiLCBzdGF0ZS54LTIwLCB5LTMwKTsgfQogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBzZWVkRGlzcGVyc2FsOiB7CiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUgPSB7IHNlZWRzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHtjdHgsIHdpZHRoLCBoZWlnaHQsIHN0YXRlfSA9IHNpbTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM4N0NFRUInOyBjdHguZmlsbFJlY3QoMCwwLHdpZHRoLGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMjI4QjIyJzsgY3R4LmZpbGxSZWN0KDAsIGhlaWdodC0yMCwgd2lkdGgsIDIwKTsKICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzIyOEIyMic7IGN0eC5saW5lV2lkdGggPSAzOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8oMTAwLCBoZWlnaHQtMjApOyBjdHgubGluZVRvKDEwMCwgaGVpZ2h0LTE1MCk7IGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNmZmYnOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoMTAwLCBoZWlnaHQtMTUwLCAxMCwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBpZihNYXRoLnJhbmRvbSgpIDwgMC4wNSkgc3RhdGUuc2VlZHMucHVzaCh7eDogMTAwLCB5OiBoZWlnaHQtMTUwLCB2eDogMStNYXRoLnJhbmRvbSgpLCB2eTogLTAuNStNYXRoLnJhbmRvbSgpfSk7CiAgICAgICAgICAgICAgICAgICAgc3RhdGUuc2VlZHMuZm9yRWFjaCgocywgaSkgPT4geyBzLnggKz0gcy52eDsgcy55ICs9IHMudnk7IGN0eC5zdHJva2VTdHlsZSA9ICcjZmZmJzsgY3R4LmxpbmVXaWR0aCA9IDE7IGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbyhzLngsIHMueSk7IGN0eC5saW5lVG8ocy54LTUsIHMueS01KTsgY3R4LnN0cm9rZSgpOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8ocy54LCBzLnkpOyBjdHgubGluZVRvKHMueC01LCBzLnkrNSk7IGN0eC5zdHJva2UoKTsgaWYocy54ID4gd2lkdGgpIHN0YXRlLnNlZWRzLnNwbGljZShpLCAxKTsgfSk7CiAgICAgICAgICAgICAgICAgICAgc2ltLmFuaW1JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmxvb3Aoc2ltKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGNvcmFsUmVlZjogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyAKICAgICAgICAgICAgICAgICAgICAgICAgZmlzaDogW10sCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1YmJsZXM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBjb3JhbHM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiAwCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplIEZpc2gKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwxNTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5maXNoLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogTWF0aC5yYW5kb20oKSpzaW0ud2lkdGgsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogTWF0aC5yYW5kb20oKSooc2ltLmhlaWdodCAtIDEwMCksIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdng6IChNYXRoLnJhbmRvbSgpLTAuNSkqMywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogYGhzbCgke01hdGgucmFuZG9tKCkqMzYwfSwgODAlLCA2MCUpYCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IDUgKyBNYXRoLnJhbmRvbSgpICogOAogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWxpemUgQ29yYWxzCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbnVtQ29yYWxzID0gTWF0aC5mbG9vcihzaW0ud2lkdGggLyAxNSk7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBpPTA7IGk8bnVtQ29yYWxzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlLmNvcmFscy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGkgKiAxNSArIE1hdGgucmFuZG9tKCkqNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGg6IDQwICsgTWF0aC5yYW5kb20oKSAqIDYwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGBoc2woJHtNYXRoLnJhbmRvbSgpKjYwICsgMzAwfSwgNzAlLCAkezQwICsgTWF0aC5yYW5kb20oKSoyMH0lKWAsIC8vIFBpbmtzL1B1cnBsZXMvUmVkcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogTWF0aC5yYW5kb20oKSA+IDAuNSA/ICdyb3VuZCcgOiAnYnJhbmNoJwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29wKHNpbSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9vcDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qge2N0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGV9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLnRpbWUgKz0gMC4wMjsKCiAgICAgICAgICAgICAgICAgICAgLy8gV2F0ZXIgR3JhZGllbnQKICAgICAgICAgICAgICAgICAgICBjb25zdCBncmFkID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZC5hZGRDb2xvclN0b3AoMCwgJyMwMGI0ZGInKTsKICAgICAgICAgICAgICAgICAgICBncmFkLmFkZENvbG9yU3RvcCgxLCAnIzAwODNiMCcpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkOyAKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwwLHdpZHRoLGhlaWdodCk7CgogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgQ29yYWxzCiAgICAgICAgICAgICAgICAgICAgc3RhdGUuY29yYWxzLmZvckVhY2goKGMsIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGMuY29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN3YXkgPSBNYXRoLnNpbihzdGF0ZS50aW1lICsgaSAqIDAuNSkgKiA1OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGMudHlwZSA9PT0gJ3JvdW5kJykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmVsbGlwc2UoYy54LCBoZWlnaHQsIDEwLCBjLmgvMiwgMCwgTWF0aC5QSSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQnJhbmNoL1NlYXdlZWQgbGlrZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyhjLngsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhjLnggKyBzd2F5LCBoZWlnaHQgLSBjLmgvMiwgYy54ICsgc3dheSoxLjUsIGhlaWdodCAtIGMuaCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gNDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGMuY29sb3I7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQnViYmxlcwogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wNSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5idWJibGVzLnB1c2goe3g6IE1hdGgucmFuZG9tKCkqd2lkdGgsIHk6IGhlaWdodCwgcjogTWF0aC5yYW5kb20oKSozICsgMSwgdjogTWF0aC5yYW5kb20oKSoxICsgMC41fSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGF0ZS5idWJibGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBiID0gc3RhdGUuYnViYmxlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgYi55IC09IGIudjsKICAgICAgICAgICAgICAgICAgICAgICAgYi54ICs9IE1hdGguc2luKGIueSAqIDAuMDUpICogMC41OwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKSc7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhiLngsIGIueSwgYi5yLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYi55IDwgMCkgc3RhdGUuYnViYmxlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBGaXNoCiAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmlzaC5mb3JFYWNoKGYgPT4geyAKICAgICAgICAgICAgICAgICAgICAgICAgZi54ICs9IGYudng7IAogICAgICAgICAgICAgICAgICAgICAgICBpZihmLnggPCAtMjApIGYueCA9IHdpZHRoICsgMjA7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGYueCA+IHdpZHRoICsgMjApIGYueCA9IC0yMDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoZi54LCBmLnkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi52eCA8IDApIGN0eC5zY2FsZSgtMSwgMSk7CgogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gZi5jb2xvcjsgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJvZHkKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmVsbGlwc2UoMCwgMCwgZi5zaXplLCBmLnNpemUvMS41LCAwLCAwLCBNYXRoLlBJKjIpOyAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGwoKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRhaWwKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4Lm1vdmVUbygtZi5zaXplLzIsIDApOyAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbygtZi5zaXplLTUsIC01KTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oLWYuc2l6ZS01LCA1KTsgCiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEV5ZQogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3doaXRlJzsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKGYuc2l6ZS8yLCAtMiwgMiwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhmLnNpemUvMiArIDEsIC0yLCAxLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBTdW4gcmF5cwogICAgICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdvdmVybGF5JzsKICAgICAgICAgICAgICAgICAgICBjb25zdCByYXlHcmFkID0gY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDAsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgcmF5R3JhZC5hZGRDb2xvclN0b3AoMCwgJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4xKScpOwogICAgICAgICAgICAgICAgICAgIHJheUdyYWQuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDApJyk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHJheUdyYWQ7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oMCwgMCk7IGN0eC5saW5lVG8od2lkdGgsIDApOyBjdHgubGluZVRvKHdpZHRoICogMC44LCBoZWlnaHQpOyBjdHgubGluZVRvKHdpZHRoICogMC4yLCBoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgICAgICAgICAgc2ltLmFuaW1JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmxvb3Aoc2ltKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZpcmVmbGllczogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyBmbGllczogW10gfTsKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwzMDsgaSsrKSBzaW0uc3RhdGUuZmxpZXMucHVzaCh7eDogTWF0aC5yYW5kb20oKSpzaW0ud2lkdGgsIHk6IE1hdGgucmFuZG9tKCkqc2ltLmhlaWdodCwgdDogTWF0aC5yYW5kb20oKSoxMDB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7Y3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZX0gPSBzaW07CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDIwNjE3JzsgY3R4LmZpbGxSZWN0KDAsMCx3aWR0aCxoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLmZsaWVzLmZvckVhY2goZiA9PiB7IGYueCArPSAoTWF0aC5yYW5kb20oKS0wLjUpOyBmLnkgKz0gKE1hdGgucmFuZG9tKCktMC41KTsgZi50ICs9IDAuMTsgY29uc3QgYWxwaGEgPSAoTWF0aC5zaW4oZi50KSsxKS8yOyBjdHguZmlsbFN0eWxlID0gYHJnYmEoMjU1LCAyNTUsIDAsICR7YWxwaGF9KWA7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhmLngsIGYueSwgMywgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsgY3R4LnNoYWRvd0JsdXIgPSAxMDsgY3R4LnNoYWRvd0NvbG9yID0gJ3llbGxvdyc7IGN0eC5maWxsKCk7IGN0eC5zaGFkb3dCbHVyID0gMDsgfSk7CiAgICAgICAgICAgICAgICAgICAgc2ltLmFuaW1JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmxvb3Aoc2ltKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGZvc3NpbDogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0geyBzZWRpbWVudEg6IDAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7Y3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZX0gPSBzaW07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU2t5ICYgQmFzZSBHcm91bmQKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM4N0NFRUInOyBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjNUQ0MDM3JzsgY3R4LmZpbGxSZWN0KDAsIGhlaWdodC00MCwgd2lkdGgsIDQwKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIEZvc3NpbGl6YXRpb24gU3RhdGUgKDAgPSBmcmVzaCwgMSA9IGZvc3NpbGl6ZWQpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9zc2lsRmFjdG9yID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgKHN0YXRlLnNlZGltZW50SCAtIDMwKSAvIDEwMCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEludGVycG9sYXRlIGNvbG9yOiBXaGl0ZSAoI0ZGRikgdG8gU3RvbmUgKCM0RTM0MkUpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IDI1NSAtICgyNTUtNzgpKmZvc3NpbEZhY3RvcjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gMjU1IC0gKDI1NS01MikqZm9zc2lsRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSAyNTUgLSAoMjU1LTQ2KSpmb3NzaWxGYWN0b3I7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm9uZUNvbG9yID0gYHJnYigke3J9LCR7Z30sJHtifSlgOwoKICAgICAgICAgICAgICAgICAgICAvLyAzLiBEcmF3IFNrZWxldG9uCiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHdpZHRoLzIsIGhlaWdodC00NSk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYm9uZUNvbG9yOyBjdHgubGluZVdpZHRoID0gNDsgY3R4LmxpbmVDYXAgPSAncm91bmQnOyBjdHguZmlsbFN0eWxlID0gYm9uZUNvbG9yOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIERyYXcgRGlubyBTa2VsZXRvbgogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbygtNDAsIDApOyBjdHgucXVhZHJhdGljQ3VydmVUbygwLCAtMTAsIDUwLCA1KTsgY3R4LnN0cm9rZSgpOyAvLyBTcGluZQogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0tMjA7IGk8MjA7IGkrPTgpIHsgY3R4LmJlZ2luUGF0aCgpOyBjdHgubW92ZVRvKGksIC01KTsgY3R4LmxpbmVUbyhpLCA1KTsgY3R4LnN0cm9rZSgpOyB9IC8vIFJpYnMKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8oLTQwLCAwKTsgY3R4LmxpbmVUbygtNTUsIC01KTsgY3R4LmxpbmVUbygtNjAsIDUpOyBjdHgubGluZVRvKC00NSwgNSk7IGN0eC5jbG9zZVBhdGgoKTsgY3R4LmZpbGwoKTsgLy8gSGVhZAogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbygtMjAsIDApOyBjdHgubGluZVRvKC0yNSwgMjApOyBjdHguc3Ryb2tlKCk7IC8vIExlZwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbygyMCwgMCk7IGN0eC5saW5lVG8oMjUsIDIwKTsgY3R4LnN0cm9rZSgpOyAvLyBMZWcKICAgICAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAgICAgICAgICAgICAvLyA0LiBTZWRpbWVudCBBY2N1bXVsYXRpb24KICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc2VkaW1lbnRIIDwgaGVpZ2h0IC0gNDApIHN0YXRlLnNlZGltZW50SCArPSAwLjU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBMYXllcnMKICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudFkgPSBoZWlnaHQgLSA0MDsKICAgICAgICAgICAgICAgICAgICBsZXQgcmVtYWluaW5nID0gc3RhdGUuc2VkaW1lbnRIOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheWVycyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAge2g6IDQwLCBjOiAncmdiYSgxMjEsIDg1LCA3MiwgMC43KSd9LCAvLyBNdWQKICAgICAgICAgICAgICAgICAgICAgICAge2g6IDQwLCBjOiAncmdiYSgxNDEsIDExMCwgOTksIDAuNyknfSwgLy8gU2lsdAogICAgICAgICAgICAgICAgICAgICAgICB7aDogNjAsIGM6ICdyZ2JhKDE2MSwgMTM2LCAxMjcsIDAuOCknfSwgLy8gU2FuZAogICAgICAgICAgICAgICAgICAgICAgICB7aDogMjAwLCBjOiAncmdiYSg2MiwgMzksIDM1LCAwLjkpJ30gICAvLyBSb2NrCiAgICAgICAgICAgICAgICAgICAgXTsKCiAgICAgICAgICAgICAgICAgICAgbGF5ZXJzLmZvckVhY2gobCA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZW1haW5pbmcgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoID0gTWF0aC5taW4ocmVtYWluaW5nLCBsLmgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGwuYzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCBjdXJyZW50WSAtIGgsIHdpZHRoLCBoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRZIC09IGg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1haW5pbmcgLT0gaDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICAvLyA1LiBUZXh0CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMDAwJzsKICAgICAgICAgICAgICAgICAgICBjdHguZm9udCA9ICcxNHB4IHNhbnMtc2VyaWYnOwogICAgICAgICAgICAgICAgICAgIGlmIChmb3NzaWxGYWN0b3IgPCAwLjIpIGN0eC5maWxsVGV4dCgiQnVyaWFsLi4uIiwgMTAsIDMwKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChmb3NzaWxGYWN0b3IgPCAwLjgpIGN0eC5maWxsVGV4dCgiUHJlc3N1cmUgJiBUaW1lLi4uIiwgMTAsIDMwKTsKICAgICAgICAgICAgICAgICAgICBlbHNlIGN0eC5maWxsVGV4dCgiRm9zc2lsaXplZCEiLCAxMCwgMzApOwoKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgY2F2ZXM6IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgaDogMCwgZHJvcFk6IDAgfTsKICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7Y3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZX0gPSBzaW07CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMmMyYzJjJzsgY3R4LmZpbGxSZWN0KDAsMCx3aWR0aCxoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGlmKHN0YXRlLmggPCAxMDApIHN0YXRlLmggKz0gMC4xOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI2QzZDNkMyc7IGN0eC5iZWdpblBhdGgoKTsgY3R4Lm1vdmVUbyh3aWR0aC8yLTIwLCAwKTsgY3R4LmxpbmVUbyh3aWR0aC8yKzIwLCAwKTsgY3R4LmxpbmVUbyh3aWR0aC8yLCBzdGF0ZS5oKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8od2lkdGgvMi0yMCwgaGVpZ2h0KTsgY3R4LmxpbmVUbyh3aWR0aC8yKzIwLCBoZWlnaHQpOyBjdHgubGluZVRvKHdpZHRoLzIsIGhlaWdodC1zdGF0ZS5oKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5kcm9wWSArPSA1OyBpZihzdGF0ZS5kcm9wWSA+IGhlaWdodCkgc3RhdGUuZHJvcFkgPSBzdGF0ZS5oOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwZic7IGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyh3aWR0aC8yLCBzdGF0ZS5kcm9wWSwgMywgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgcm9ja0N5Y2xlOiB7CiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUgPSB7IGFuZ2xlOiAwIH07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29wKHNpbSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9vcDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qge2N0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGV9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnI0ZBQjk3Mic7IGN0eC5maWxsUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5hbmdsZSArPSAwLjAxOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gd2lkdGgvMiwgY3kgPSBoZWlnaHQvMiwgciA9IDEwMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlcyA9IFsnTWFnbWEnLCAnSWduZW91cycsICdTZWRpbWVudCcsICdTZWRpbWVudGFyeScsICdNZXRhbW9ycGhpYyddOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9ycyA9IFsnI2YwMCcsICcjNTU1JywgJyNlZWMnLCAnI2QyYjQ4YycsICcjNzA4MDkwJ107CiAgICAgICAgICAgICAgICAgICAgdHlwZXMuZm9yRWFjaCgodCwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhID0gc3RhdGUuYW5nbGUgKyAoaSAqIE1hdGguUEkqMiAvIHR5cGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHggPSBjeCArIE1hdGguY29zKGEpICogciwgeSA9IGN5ICsgTWF0aC5zaW4oYSkgKiByOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29sb3JzW2ldOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMoeCwgeSwgMzAsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7IGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsgY3R4LmZpbGxUZXh0KHQsIHgsIHkrNDApOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjMDAwJzsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKGN4LCBjeSwgciwgMCwgTWF0aC5QSSoyKTsgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBnZXlzZXI6IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgcHJlc3N1cmU6IDAsIGVydXB0aW5nOiBmYWxzZSwgcGFydGljbGVzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHtjdHgsIHdpZHRoLCBoZWlnaHQsIHN0YXRlfSA9IHNpbTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyM4N0NFRUInOyBjdHguZmlsbFJlY3QoMCwwLHdpZHRoLGhlaWdodCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjOEI0NTEzJzsgY3R4LmZpbGxSZWN0KDAsIGhlaWdodC01MCwgd2lkdGgsIDUwKTsKICAgICAgICAgICAgICAgICAgICBpZighc3RhdGUuZXJ1cHRpbmcpIHsgc3RhdGUucHJlc3N1cmUgKz0gMTsgaWYoc3RhdGUucHJlc3N1cmUgPiAyMDApIHN0YXRlLmVydXB0aW5nID0gdHJ1ZTsgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgeyBzdGF0ZS5wcmVzc3VyZSAtPSAyOyBpZihzdGF0ZS5wcmVzc3VyZSA8IDApIHN0YXRlLmVydXB0aW5nID0gZmFsc2U7IGZvcihsZXQgaT0wOyBpPDU7IGkrKykgc3RhdGUucGFydGljbGVzLnB1c2goe3g6IHdpZHRoLzIsIHk6IGhlaWdodC01MCwgdnk6IC01IC0gTWF0aC5yYW5kb20oKSo1LCB2eDogKE1hdGgucmFuZG9tKCktMC41KSoyfSk7IH0KICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9c3RhdGUucGFydGljbGVzLmxlbmd0aC0xOyBpPj0wOyBpLS0pIHsgbGV0IHAgPSBzdGF0ZS5wYXJ0aWNsZXNbaV07IHAueCArPSBwLnZ4OyBwLnkgKz0gcC52eTsgcC52eSArPSAwLjE7IGN0eC5maWxsU3R5bGUgPSAncmdiYSgyNTUsMjU1LDI1NSwwLjcpJzsgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKHAueCwgcC55LCAzLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOyBpZihwLnkgPiBoZWlnaHQpIHN0YXRlLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7IH0KICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgYmxhY2tIb2xlOiB7CiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUgPSB7IHBhcnRpY2xlczogW10sIHN0YXJzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIC8vIEJhY2tncm91bmQgc3RhcnMKICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTwxMDA7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUuc3RhcnMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiBNYXRoLnJhbmRvbSgpICogc2ltLndpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogTWF0aC5yYW5kb20oKSAqIHNpbS5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBNYXRoLnJhbmRvbSgpICogMS41LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IE1hdGgucmFuZG9tKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gd2lkdGggLyAyLCBjeSA9IGhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYXIgd2l0aCB0cmFpbHMKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMCwgMCwgMCwgMC4yKSc7IAogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBiYWNrZ3JvdW5kIHN0YXJzIChzdGF0aWMpCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmZmJzsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFycy5mb3JFYWNoKHMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBzLmFscGhhOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMocy54LCBzLnksIHMuc2l6ZSwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgICAgICAgICAvLyBTcGF3biBtYXR0ZXIgcGFydGljbGVzCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLnBhcnRpY2xlcy5sZW5ndGggPCAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLm1heCh3aWR0aCwgaGVpZ2h0KSAqIDAuNjsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucGFydGljbGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgeDogY3ggKyBNYXRoLmNvcyhhbmdsZSkgKiBkaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogY3kgKyBNYXRoLnNpbihhbmdsZSkgKiBkaXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdng6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2eTogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFuZ2xlOiBhbmdsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3Q6IGRpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGVlZDogMSArIE1hdGgucmFuZG9tKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgYW5kIGRyYXcgcGFydGljbGVzCiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXRlLnBhcnRpY2xlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgcCA9IHN0YXRlLnBhcnRpY2xlc1tpXTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNwaXJhbCBtb3ZlbWVudAogICAgICAgICAgICAgICAgICAgICAgICBwLmRpc3QgLT0gcC5zcGVlZDsKICAgICAgICAgICAgICAgICAgICAgICAgcC5hbmdsZSArPSAwLjAyICsgKDEwMCAvIChwLmRpc3QgKyAxKSkgKiAwLjAwMTsgLy8gRmFzdGVyIHdoZW4gY2xvc2VyCiAgICAgICAgICAgICAgICAgICAgICAgIHAuc3BlZWQgKz0gMC4wNTsgLy8gQWNjZWxlcmF0ZSBpbgoKICAgICAgICAgICAgICAgICAgICAgICAgcC54ID0gY3ggKyBNYXRoLmNvcyhwLmFuZ2xlKSAqIHAuZGlzdDsKICAgICAgICAgICAgICAgICAgICAgICAgcC55ID0gY3kgKyBNYXRoLnNpbihwLmFuZ2xlKSAqIHAuZGlzdDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yVmFsID0gTWF0aC5taW4oMjU1LCBNYXRoLmZsb29yKDI1NSAqICgyMDAvcC5kaXN0KSkpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigyNTUsICR7MjU1LWNvbG9yVmFsfSwgJHsyNTUtY29sb3JWYWx9KWA7IC8vIFdoaXRlIHRvIFJlZC9Ib3QKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpemUgPSBNYXRoLm1heCgxLCAzIC0gKHAuZGlzdCAvIDIwMCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMocC54LCBwLnksIHNpemUsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5kaXN0IDwgMjApIHN0YXRlLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7IC8vIEV2ZW50IGhvcml6b24KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEFjY3JldGlvbiBEaXNrIEdsb3cKICAgICAgICAgICAgICAgICAgICBjb25zdCBncmFkID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGN4LCBjeSwgMjAsIGN4LCBjeSwgNjApOwogICAgICAgICAgICAgICAgICAgIGdyYWQuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKDI1NSwgMTAwLCAwLCAwLjgpJyk7CiAgICAgICAgICAgICAgICAgICAgZ3JhZC5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMjU1LCAwLCAwLCAwKScpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsgY3R4LmFyYyhjeCwgY3ksIDYwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBFdmVudCBIb3Jpem9uIChCbGFjayBIb2xlKQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwMCc7CiAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOyBjdHguYXJjKGN4LCBjeSwgMjAsIDAsIE1hdGguUEkqMik7IGN0eC5maWxsKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JnYmEoMjU1LDI1NSwyNTUsMC41KSc7IGN0eC5saW5lV2lkdGggPSAxOyBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgICAgIHNpbS5hbmltSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy5sb29wKHNpbSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBtZXRlb3JTaG93ZXI6IHsKICAgICAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZSA9IHsgbWV0ZW9yczogW10sIHN0YXJzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5zdGFycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucmFuZG9tKCkgKiBzaW0ud2lkdGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLnJhbmRvbSgpICogc2ltLmhlaWdodCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IE1hdGgucmFuZG9tKCkgKiAyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxwaGE6IE1hdGgucmFuZG9tKCkKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9vcChzaW0pOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGxvb3A6IGZ1bmN0aW9uKHNpbSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgY3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZSB9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEZhZGUgYmFja2dyb3VuZCBmb3IgdHJhaWxzCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDE1LCAyMywgNDIsIDAuMyknOyAKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFN0YXJzCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjZmZmJzsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdGFycy5mb3JFYWNoKHMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBzLmFscGhhOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMocy54LCBzLnksIHMuc2l6ZSwgMCwgTWF0aC5QSSoyKTsgY3R4LmZpbGwoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgICAgICAgICAvLyBTcGF3biBNZXRlb3JzCiAgICAgICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubWV0ZW9ycy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucmFuZG9tKCkgKiB3aWR0aCAqIDEuNSwgLy8gU3RhcnQgb2ZmLXNjcmVlbiByaWdodC90b3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IC01MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZ4OiAtNSAtIE1hdGgucmFuZG9tKCkgKiA1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdnk6IDMgKyBNYXRoLnJhbmRvbSgpICogNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbjogMTAgKyBNYXRoLnJhbmRvbSgpICogMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZlOiAxLjAKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgTWV0ZW9ycwogICAgICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9ICcjZmZmJzsKICAgICAgICAgICAgICAgICAgICBjdHgubGluZUNhcCA9ICdyb3VuZCc7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXRlLm1ldGVvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG0gPSBzdGF0ZS5tZXRlb3JzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICBtLnggKz0gbS52eDsKICAgICAgICAgICAgICAgICAgICAgICAgbS55ICs9IG0udnk7CiAgICAgICAgICAgICAgICAgICAgICAgIG0ubGlmZSAtPSAwLjAyOwoKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDIgKiBtLmxpZmU7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IG0ubGlmZTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHgubW92ZVRvKG0ueCwgbS55KTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhtLnggLSBtLnZ4ICogMywgbS55IC0gbS52eSAqIDMpOyAvLyBUcmFpbAogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobS5saWZlIDw9IDAgfHwgbS55ID4gaGVpZ2h0IHx8IG0ueCA8IDApIHN0YXRlLm1ldGVvcnMuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgc29sYXJGbGFyZTogewogICAgICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgc2ltLnN0YXRlID0gewogICAgICAgICAgICAgICAgICAgICAgICB0OiAwLAogICAgICAgICAgICAgICAgICAgICAgICBmbGFyZXM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZXM6IFtdLAogICAgICAgICAgICAgICAgICAgICAgICBzdXJmYWNlTm9pc2U6IFtdCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplIHN1cmZhY2Ugbm9pc2UgZm9yIGdyYW51bGF0aW9uIGVmZmVjdAogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNpbS5zdGF0ZS5zdXJmYWNlTm9pc2UucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IE1hdGgucmFuZG9tKCkgKiA1ICsgMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFscGhhOiBNYXRoLnJhbmRvbSgpICogMC41ICsgMC4yCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLmxvb3Aoc2ltKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb29wOiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB7Y3R4LCB3aWR0aCwgaGVpZ2h0LCBzdGF0ZX0gPSBzaW07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3ggPSB3aWR0aCAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3kgPSBoZWlnaHQgLyAyOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1blJhZGl1cyA9IDEwMDsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS50ICs9IDAuMDU7CgogICAgICAgICAgICAgICAgICAgIC8vIEJhY2tncm91bmQgKFNwYWNlKQogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzAwMDAwMCc7CiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IFN1biBIYWxvL0Nvcm9uYQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGN4LCBjeSwgc3VuUmFkaXVzLCBjeCwgY3ksIHN1blJhZGl1cyAqIDMpOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDEwMCwgMCwgMC44KScpOwogICAgICAgICAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjIsICdyZ2JhKDI1NSwgNTAsIDAsIDAuNCknKTsKICAgICAgICAgICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMjU1LCAwLCAwLCAwKScpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIHN1blJhZGl1cyAqIDMsIDAsIE1hdGguUEkgKiAyKTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBEcmF3IFN1biBCb2R5CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VuR3JhZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChjeCwgY3ksIHN1blJhZGl1cyAqIDAuMiwgY3gsIGN5LCBzdW5SYWRpdXMpOwogICAgICAgICAgICAgICAgICAgIHN1bkdyYWQuYWRkQ29sb3JTdG9wKDAsICcjRkRCODEzJyk7IC8vIFllbGxvdyBjZW50ZXIKICAgICAgICAgICAgICAgICAgICBzdW5HcmFkLmFkZENvbG9yU3RvcCgwLjgsICcjRkY4QzAwJyk7IC8vIE9yYW5nZSBlZGdlCiAgICAgICAgICAgICAgICAgICAgc3VuR3JhZC5hZGRDb2xvclN0b3AoMSwgJyNGRjQ1MDAnKTsgLy8gUmVkLU9yYW5nZSByaW0KICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gc3VuR3JhZDsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhjeCwgY3ksIHN1blJhZGl1cywgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFN1cmZhY2UgR3JhbnVsYXRpb24gKFNpbXBsZSkKICAgICAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYXJjKGN4LCBjeSwgc3VuUmFkaXVzLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgICAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zdXJmYWNlTm9pc2UuZm9yRWFjaChuID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUm90YXRlIG5vaXNlIHNsaWdodGx5CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gbi54ICsgc3RhdGUudCAqIDAuMDI7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSAobi55IC8gTWF0aC5QSSkgKiBzdW5SYWRpdXM7IC8vIFNpbXBsZSBtYXBwaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByb2plY3QgdG8gMkQgZGlzawogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBweCA9IGN4ICsgTWF0aC5jb3MoYW5nbGUpICogcjsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHkgPSBjeSArIE1hdGguc2luKGFuZ2xlKSAqIHIgKiAwLjg7IC8vIEZsYXR0ZW4gc2xpZ2h0bHkgZm9yIDNEIGVmZmVjdAogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2JhKDI1NSwgMjAwLCAwLCAke24uYWxwaGF9KWA7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmFyYyhweCwgcHksIG4uc2l6ZSwgMCwgTWF0aC5QSSAqIDIpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFJhbmRvbWx5IHNwYXduIGZsYXJlcwogICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4wMikgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMjsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmxhcmVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGU6IGFuZ2xlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZTogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heExpZmU6IDEwMCArIE1hdGgucmFuZG9tKCkgKiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogMC41ICsgTWF0aC5yYW5kb20oKSAqIDEuNQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbmQgRHJhdyBGbGFyZXMgKE1hZ25ldGljIExvb3BzKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGF0ZS5mbGFyZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGYgPSBzdGF0ZS5mbGFyZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIGYubGlmZSsrOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBmLmxpZmUgLyBmLm1heExpZmU7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3d0aCA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7IC8vIDAgLT4gMSAtPiAwCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvb3BIZWlnaHQgPSA2MCAqIGYuc2NhbGUgKiBncm93dGg7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgYmFzZSBwb2ludHMgb24gc3VuIHN1cmZhY2UKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeDEgPSBjeCArIE1hdGguY29zKGYuYW5nbGUgLSAwLjEpICogc3VuUmFkaXVzOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB5MSA9IGN5ICsgTWF0aC5zaW4oZi5hbmdsZSAtIDAuMSkgKiBzdW5SYWRpdXM7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHgyID0gY3ggKyBNYXRoLmNvcyhmLmFuZ2xlICsgMC4xKSAqIHN1blJhZGl1czsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeTIgPSBjeSArIE1hdGguc2luKGYuYW5nbGUgKyAwLjEpICogc3VuUmFkaXVzOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29udHJvbCBwb2ludHMgZm9yIHF1YWRyYXRpYyBjdXJ2ZQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjWCA9IGN4ICsgTWF0aC5jb3MoZi5hbmdsZSkgKiAoc3VuUmFkaXVzICsgbG9vcEhlaWdodCAqIDIpOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjWSA9IGN5ICsgTWF0aC5zaW4oZi5hbmdsZSkgKiAoc3VuUmFkaXVzICsgbG9vcEhlaWdodCAqIDIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYHJnYmEoMjU1LCAyMDAsIDEwMCwgJHtncm93dGh9KWA7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5saW5lV2lkdGggPSAzICogZ3Jvd3RoOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oeDEsIHkxKTsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oY1gsIGNZLCB4MiwgeTIpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBFamVjdCBwYXJ0aWNsZXMgYXQgcGVhawogICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPiAwLjQgJiYgcHJvZ3Jlc3MgPCAwLjYgJiYgTWF0aC5yYW5kb20oKSA8IDAuMykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUucGFydGljbGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IGN4ICsgTWF0aC5jb3MoZi5hbmdsZSkgKiAoc3VuUmFkaXVzICsgbG9vcEhlaWdodCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeTogY3kgKyBNYXRoLnNpbihmLmFuZ2xlKSAqIChzdW5SYWRpdXMgKyBsb29wSGVpZ2h0KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2eDogTWF0aC5jb3MoZi5hbmdsZSkgKiAoMiArIE1hdGgucmFuZG9tKCkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZ5OiBNYXRoLnNpbihmLmFuZ2xlKSAqICgyICsgTWF0aC5yYW5kb20oKSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmZTogNjAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5saWZlID49IGYubWF4TGlmZSkgc3RhdGUuZmxhcmVzLnNwbGljZShpLCAxKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBhbmQgRHJhdyBQYXJ0aWNsZXMgKFNvbGFyIFdpbmQvQ01FKQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGF0ZS5wYXJ0aWNsZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHAgPSBzdGF0ZS5wYXJ0aWNsZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIHAueCArPSBwLnZ4OwogICAgICAgICAgICAgICAgICAgICAgICBwLnkgKz0gcC52eTsKICAgICAgICAgICAgICAgICAgICAgICAgcC5saWZlLS07CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoMjU1LCAyNTUsIDIwMCwgJHtwLmxpZmUgLyA2MH0pYDsKICAgICAgICAgICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYXJjKHAueCwgcC55LCAyLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgICAgICAgICAgICAgIGN0eC5maWxsKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAocC5saWZlIDw9IDApIHN0YXRlLnBhcnRpY2xlcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBzaW0uYW5pbUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHRoaXMubG9vcChzaW0pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgbWlncmF0aW9uOiB7CiAgICAgICAgICAgICAgICBpbml0OiBmdW5jdGlvbihzaW0pIHsKICAgICAgICAgICAgICAgICAgICBzaW0uc3RhdGUgPSB7IGJpcmRzOiBbXSB9OwogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpPDIwOyBpKyspIHNpbS5zdGF0ZS5iaXJkcy5wdXNoKHt4OiAtTWF0aC5yYW5kb20oKSoxMDAsIHk6IDUwICsgTWF0aC5yYW5kb20oKSoyMDAsIHNwZWVkOiAyK01hdGgucmFuZG9tKCksIG9mZnNldDogTWF0aC5yYW5kb20oKSAqIDEwfSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb29wKHNpbSk7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgbG9vcDogZnVuY3Rpb24oc2ltKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qge2N0eCwgd2lkdGgsIGhlaWdodCwgc3RhdGV9ID0gc2ltOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzg3Q0VFQic7IGN0eC5maWxsUmVjdCgwLDAsd2lkdGgsaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyMyMjhCMjInOyBjdHguYmVnaW5QYXRoKCk7IGN0eC5hcmMod2lkdGgvMiwgaGVpZ2h0KzIwMCwgMzAwLCAwLCBNYXRoLlBJKjIpOyBjdHguZmlsbCgpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBEYXRlLm5vdygpIC8gMTAwOwogICAgICAgICAgICAgICAgICAgIHN0YXRlLmJpcmRzLmZvckVhY2goYiA9PiB7IAogICAgICAgICAgICAgICAgICAgICAgICBiLnggKz0gYi5zcGVlZDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGIueCA+IHdpZHRoICsgMjApIGIueCA9IC0yMDsgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdpbmdZID0gTWF0aC5zaW4odCAqIDIgKyBiLm9mZnNldCkgKiA1OwogICAgICAgICAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAnIzAwMCc7IGN0eC5saW5lV2lkdGggPSAyOwogICAgICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7IGN0eC5tb3ZlVG8oYi54IC0gNiwgYi55ICsgd2luZ1kpOyBjdHgubGluZVRvKGIueCwgYi55KTsgY3R4LmxpbmVUbyhiLnggKyA2LCBiLnkgKyB3aW5nWSk7IGN0eC5zdHJva2UoKTsgCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgc2ltLmFuaW1JZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLmxvb3Aoc2ltKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCgogICAgICAgICAgICBkcmF3UGxhY2Vob2xkZXI6IGZ1bmN0aW9uKHNpbSwgdGV4dCkgewogICAgICAgICAgICAgICAgY29uc3QgeyBjdHgsIHdpZHRoLCBoZWlnaHQgfSA9IHNpbTsKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnIzM3NDE1MSc7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJyNkMWQ1ZGInOwogICAgICAgICAgICAgICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgICAgICAgICAgICAgY3R4LmZvbnQgPSAnMjRweCBzZXJpZic7CiAgICAgICAgICAgICAgICBjdHguZmlsbFRleHQodGV4dCwgd2lkdGgvMiwgaGVpZ2h0LzIpOwogICAgICAgICAgICAgICAgY3R4LmZvbnQgPSAnMTRweCBzYW5zLXNlcmlmJzsKICAgICAgICAgICAgICAgIGN0eC5maWxsVGV4dCgiKEFuaW1hdGlvbiBDb21pbmcgU29vbiEpIiwgd2lkdGgvMiwgaGVpZ2h0LzIgKyAzMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLyBTdGFydAogICAgICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgQm9vay5pbml0KCk7CiAgICAgICAgfTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4KPC9odG1sPg=="))));</script>